Thu Dec  9 12:29:36 PM EET 2021
+ hostname
localhost.localdomain
+ ansible-playbook infra.yaml --diff
 ___________________________________
< PLAY [Collect info about all VMs] >
 -----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ________________________
< TASK [Gathering Facts] >
 ------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 ______________
< TASK [setup] >
 --------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 _____________
< PLAY [Init] >
 -------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ________________________________
< TASK [init : Update APT cache] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
changed: [manmanmano-1]
changed: [manmanmano-3]
 ___________________________________________________________
< TASK [backup : Add the user backup and generate ssh keys] >
 -----------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-1]
changed: [manmanmano-2]
changed: [manmanmano-3]
 __________________________________________________________
< TASK [backup : Create directory restore for user backup] >
 ----------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [manmanmano-1]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [manmanmano-3]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [manmanmano-2]
 ___________________________________
< TASK [backup : Install duplicity] >
 -----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 139 not upgraded.
changed: [manmanmano-2]
The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 139 not upgraded.
changed: [manmanmano-1]
The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 139 not upgraded.
changed: [manmanmano-3]
 __________________________________
< TASK [backup : Copy known_hosts] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpwsk8mrep/known_hosts.j2
@@ -0,0 +1,2 @@
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBSne71MCp6CQCHURWe3CLud6vPDkLfL83Oab/giAI7O
+backup.clounsible.mano ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBSne71MCp6CQCHURWe3CLud6vPDkLfL83Oab/giAI7O

changed: [manmanmano-1]
--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpm2zzln6_/known_hosts.j2
@@ -0,0 +1,2 @@
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBSne71MCp6CQCHURWe3CLud6vPDkLfL83Oab/giAI7O
+backup.clounsible.mano ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBSne71MCp6CQCHURWe3CLud6vPDkLfL83Oab/giAI7O

changed: [manmanmano-2]
--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpovnfve9y/known_hosts.j2
@@ -0,0 +1,2 @@
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBSne71MCp6CQCHURWe3CLud6vPDkLfL83Oab/giAI7O
+backup.clounsible.mano ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBSne71MCp6CQCHURWe3CLud6vPDkLfL83Oab/giAI7O

changed: [manmanmano-3]
 ___________________
< PLAY [DNS server] >
 -------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 _______________________________________
< TASK [bind : Install package "bind9"] >
 ---------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils dns-root-data python3-ply
Suggested packages:
  bind-doc resolvconf python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data python3-dnspython python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs
2 upgraded, 5 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-2]
The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils dns-root-data python3-ply
Suggested packages:
  bind-doc resolvconf python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data python3-dnspython python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs
2 upgraded, 5 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-1]
The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils dns-root-data python3-ply
Suggested packages:
  bind-doc resolvconf python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data python3-dnspython python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs
2 upgraded, 5 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-3]
 ____________________________
< TASK [bind : Service bind] >
 ----------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ____________________________________
< TASK [bind : Copy db.startup_name] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-1]
skipping: [manmanmano-3]
--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpyj0wply5/db.clounsible.mano.j2
@@ -0,0 +1,14 @@
+$TTL    604800
+clounsible.mano.       IN      SOA     manmanmano-2.clounsible.mano. mariano.clounsible.mano. (
+                              2         ; Serial
+                         604800         ; Refresh
+                          86400         ; Retry
+                        2419200         ; Expire
+                         604800 )       ; Negative Cache TTL
+;
+clounsible.mano.       IN      NS      manmanmano-2 
+clounsible.mano.       IN      NS      manmanmano-1 
+clounsible.mano.       IN      NS      manmanmano-3 
+manmanmano-2       IN      A       192.168.42.50
+manmanmano-1       IN      A       192.168.42.115
+manmanmano-3       IN      A       192.168.42.126

changed: [manmanmano-2]
 _______________________________
< TASK [bind : Copy db.reverse] >
 -------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-1]
skipping: [manmanmano-3]
--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpjg_1u3wj/db.reverse.j2
@@ -0,0 +1,14 @@
+$TTL    604800
+42.168.192.in-addr.arpa.       IN      SOA     manmanmano-2.clounsible.mano. mariano.clounsible.mano. (
+                              2         ; Serial
+                         604800         ; Refresh
+                          86400         ; Retry
+                        2419200         ; Expire
+                         604800 )       ; Negative Cache TTL
+;
+42.168.192.in-addr.arpa.       IN      NS      manmanmano-2.clounsible.mano. 
+42.168.192.in-addr.arpa.       IN      NS      manmanmano-1.clounsible.mano. 
+42.168.192.in-addr.arpa.       IN      NS      manmanmano-3.clounsible.mano. 
+115 IN PTR manmanmano-1.clounsible.mano.
+50 IN PTR manmanmano-2.clounsible.mano.
+126 IN PTR manmanmano-3.clounsible.mano.

changed: [manmanmano-2]
 ___________________________________________
< TASK [bind : Copy new named.conf.options] >
 -------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-1]
changed: [manmanmano-3]
changed: [manmanmano-2]
 _________________________________________
< TASK [bind : Copy new named.conf.local] >
 -----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before: /etc/bind/named.conf.local
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmp5bd__oef/named.conf.local.j2
@@ -1,8 +1,14 @@
-//
-// Do any local configuration here
-//
+zone "clounsible.mano" {
+    type primary;
+    allow-update { key nsupdate.key; 127.0.0.1; };
+    allow-transfer { key transfer.key; 127.0.0.1; };
+    file "db.clounsible.mano";
+};
 
-// Consider adding the 1918 zones here, if they are not used in your
-// organization
-//include "/etc/bind/zones.rfc1918";
+zone "42.168.192.in-addr.arpa" {
+    type primary;
+    allow-update { key nsupdate.key; 127.0.0.1; };
+    allow-transfer { key transfer.key; 127.0.0.1; };
+    file "db.reverse";
+};
 

changed: [manmanmano-2]
--- before: /etc/bind/named.conf.local
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpa1w1tbqo/named.conf.local.j2
@@ -1,8 +1,15 @@
-//
-// Do any local configuration here
-//
+zone "clounsible.mano" {
+    type secondary;
+    masters { 192.168.42.50; };
+    file "db.clounsible.mano";
+};
 
-// Consider adding the 1918 zones here, if they are not used in your
-// organization
-//include "/etc/bind/zones.rfc1918";
+zone "42.168.192.in-addr.arpa" {
+    type secondary;
+    masters { 192.168.42.50; };
+    file "db.reverse";
+};
 
+server 192.168.42.50 {
+    keys { transfer.key; };
+};

changed: [manmanmano-1]
--- before: /etc/bind/named.conf.local
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpwheaebj6/named.conf.local.j2
@@ -1,8 +1,15 @@
-//
-// Do any local configuration here
-//
+zone "clounsible.mano" {
+    type secondary;
+    masters { 192.168.42.50; };
+    file "db.clounsible.mano";
+};
 
-// Consider adding the 1918 zones here, if they are not used in your
-// organization
-//include "/etc/bind/zones.rfc1918";
+zone "42.168.192.in-addr.arpa" {
+    type secondary;
+    masters { 192.168.42.50; };
+    file "db.reverse";
+};
 
+server 192.168.42.50 {
+    keys { transfer.key; };
+};

changed: [manmanmano-3]
 _________________________________________________________
/ TASK [bind : Force notified handlers to restart at this \
\ point]                                                  /
 ---------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 _______________________________________
< RUNNING HANDLER [bind : Restart bind] >
 ---------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-1]
changed: [manmanmano-3]
changed: [manmanmano-2]
 ______________________________________
< RUNNING HANDLER [bind : Reload bind] >
 --------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
 __________________________________
< TASK [bind : Nsupdate A records] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-1] => (item={'key': 'backup', 'value': '192.168.42.156'}) 
skipping: [manmanmano-3] => (item={'key': 'backup', 'value': '192.168.42.156'}) 
changed: [manmanmano-2] => (item={'key': 'backup', 'value': '192.168.42.156'})
 ______________________________________
< TASK [bind : Nsupdate CNAME records] >
 --------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-1] => (item={'key': 'grafana', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'influxdb', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'lb1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-3] => (item={'key': 'grafana', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'lb2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'influxdb', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'lb3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-3] => (item={'key': 'lb1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-1] => (item={'key': 'mysql1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-1] => (item={'key': 'mysql2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'lb2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'mysql3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-3] => (item={'key': 'lb3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-1] => (item={'key': 'ns1', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'mysql1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-1] => (item={'key': 'ns2', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-3] => (item={'key': 'mysql2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'ns3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-3] => (item={'key': 'mysql3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-1] => (item={'key': 'prometheus', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'ns1', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'web1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-3] => (item={'key': 'ns2', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-1] => (item={'key': 'web2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'ns3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-1] => (item={'key': 'web3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-3] => (item={'key': 'prometheus', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'web1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-3] => (item={'key': 'web2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'web3', 'value': 'manmanmano-3'}) 
changed: [manmanmano-2] => (item={'key': 'grafana', 'value': 'manmanmano-2'})
changed: [manmanmano-2] => (item={'key': 'influxdb', 'value': 'manmanmano-2'})
changed: [manmanmano-2] => (item={'key': 'lb1', 'value': 'manmanmano-1'})
changed: [manmanmano-2] => (item={'key': 'lb2', 'value': 'manmanmano-2'})
changed: [manmanmano-2] => (item={'key': 'lb3', 'value': 'manmanmano-3'})
changed: [manmanmano-2] => (item={'key': 'mysql1', 'value': 'manmanmano-1'})
changed: [manmanmano-2] => (item={'key': 'mysql2', 'value': 'manmanmano-2'})
changed: [manmanmano-2] => (item={'key': 'mysql3', 'value': 'manmanmano-3'})
changed: [manmanmano-2] => (item={'key': 'ns1', 'value': 'manmanmano-2'})
changed: [manmanmano-2] => (item={'key': 'ns2', 'value': 'manmanmano-1'})
changed: [manmanmano-2] => (item={'key': 'ns3', 'value': 'manmanmano-3'})
changed: [manmanmano-2] => (item={'key': 'prometheus', 'value': 'manmanmano-2'})
changed: [manmanmano-2] => (item={'key': 'web1', 'value': 'manmanmano-1'})
changed: [manmanmano-2] => (item={'key': 'web2', 'value': 'manmanmano-2'})
changed: [manmanmano-2] => (item={'key': 'web3', 'value': 'manmanmano-3'})
 _________________________________________________________
< TASK [bind_exporter : Install prometheus-bind-exporter] >
 ---------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-1]
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-2]
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-3]
 ______________________________________________
< TASK [bind_exporter : Service bind-exporter] >
 ----------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 _______________________________________
< RUNNING HANDLER [bind : Restart bind] >
 ---------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
 _________________________
< PLAY [Systemd-resolved] >
 -------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ____________________________________________
< TASK [systemd-resolved : Copy resolv.conf] >
 --------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before: /etc/resolv.conf
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmplupaule1/resolv.conf.j2
@@ -1,19 +1,3 @@
-# This file is managed by man:systemd-resolved(8). Do not edit.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs must not access this file directly, but only through the
-# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
-# replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
-
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+search clounsible.mano
+nameserver 192.168.42.115
+nameserver 192.168.42.126

changed: [manmanmano-1]
--- before: /etc/resolv.conf
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmppiuf0kjn/resolv.conf.j2
@@ -1,19 +1,3 @@
-# This file is managed by man:systemd-resolved(8). Do not edit.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs must not access this file directly, but only through the
-# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
-# replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
-
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+search clounsible.mano
+nameserver 192.168.42.115
+nameserver 192.168.42.126

changed: [manmanmano-2]
--- before: /etc/resolv.conf
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmp7aadzutd/resolv.conf.j2
@@ -1,19 +1,3 @@
-# This file is managed by man:systemd-resolved(8). Do not edit.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs must not access this file directly, but only through the
-# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
-# replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
-
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+search clounsible.mano
+nameserver 192.168.42.115
+nameserver 192.168.42.126

changed: [manmanmano-3]
 _________________________________________________
< TASK [systemd-resolved : Stop systemd-resolved] >
 -------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
changed: [manmanmano-3]
changed: [manmanmano-1]
 ______________________
< PLAY [Node exporter] >
 ----------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ______________________________________________
< TASK [node_exporter : install node-exporter] >
 ----------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-2]
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-3]
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-1]
 ______________________________________________
< TASK [node_exporter : Service node-exporter] >
 ----------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 ________________________
< PLAY [Database server] >
 ------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ________________________________________
< TASK [mysql : Install package "mysql"] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common
  mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libwww-perl mailx tinyca
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common mysql-server
  mysql-server-8.0 mysql-server-core-8.0
0 upgraded, 24 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-2]
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common
  mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libwww-perl mailx tinyca
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common mysql-server
  mysql-server-8.0 mysql-server-core-8.0
0 upgraded, 24 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-1]
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common
  mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libwww-perl mailx tinyca
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common mysql-server
  mysql-server-8.0 mysql-server-core-8.0
0 upgraded, 24 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-3]
 __________________________________________________
< TASK [mysql : Install package "python3-pymysql"] >
 --------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


Suggested packages:
  python-pymysql-doc
The following NEW packages will be installed:
  python3-pymysql
0 upgraded, 1 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-2]
Suggested packages:
  python-pymysql-doc
The following NEW packages will be installed:
  python3-pymysql
0 upgraded, 1 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-1]
Suggested packages:
  python-pymysql-doc
The following NEW packages will be installed:
  python3-pymysql
0 upgraded, 1 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-3]
 ______________________________
< TASK [mysql : MySQL service] >
 ------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-2]
ok: [manmanmano-1]
 _______________________________
< TASK [mysql : MySQL database] >
 -------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-3]
changed: [manmanmano-1]
changed: [manmanmano-2]
 ___________________________
< TASK [mysql : MySQL user] >
 ---------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
changed: [manmanmano-1]
changed: [manmanmano-3]
 _________________________________
< TASK [mysql : Replication user] >
 ---------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-1]
changed: [manmanmano-2]
changed: [manmanmano-3]
 ____________________________________
/ TASK [mysql : copy override.cnf to \
\ /etc/mysql/mysql.conf.d/]          /
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpicshu_k_/override.cnf.j2
@@ -0,0 +1,6 @@
+[mysqld]
+bind-address = 0.0.0.0
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 50

changed: [manmanmano-2]
--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpcr4aeleg/override.cnf.j2
@@ -0,0 +1,6 @@
+[mysqld]
+bind-address = 0.0.0.0
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 115

changed: [manmanmano-1]
--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmp2_wllcvj/override.cnf.j2
@@ -0,0 +1,6 @@
+[mysqld]
+bind-address = 0.0.0.0
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 126

changed: [manmanmano-3]
 ____________________________________________________________
< TASK [mysql : Force notified handler to restart MySQL now] >
 ------------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ________________________________________________
< RUNNING HANDLER [mysql_backup : Restart MySQL] >
 ------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-3]
changed: [manmanmano-2]
changed: [manmanmano-1]
 _________________________________________
< TASK [mysql : MySQL replica RO mode on] >
 -----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-2]
changed: [manmanmano-3]
changed: [manmanmano-1]
 __________________________________________
< TASK [mysql : MySQL primary R0 mode off] >
 ------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-1]
skipping: [manmanmano-3]
changed: [manmanmano-2]
 ________________________________________________
< TASK [mysql_exporter : install mysql-exporter] >
 ------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


The following additional packages will be installed:
  daemon
The following NEW packages will be installed:
  daemon prometheus-mysqld-exporter
0 upgraded, 2 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-2]
The following additional packages will be installed:
  daemon
The following NEW packages will be installed:
  daemon prometheus-mysqld-exporter
0 upgraded, 2 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-1]
The following additional packages will be installed:
  daemon
The following NEW packages will be installed:
  daemon prometheus-mysqld-exporter
0 upgraded, 2 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-3]
 __________________________________________
< TASK [mysql_exporter : Pause for 10 sec] >
 ------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


Pausing for 10 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [manmanmano-1]
 _____________________________________________
< TASK [mysql_exporter : MySQL exporter user] >
 ---------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-3]
changed: [manmanmano-1]
changed: [manmanmano-2]
 ________________________________
< TASK [mysql_exporter : my.cnf] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
changed: [manmanmano-3]
changed: [manmanmano-1]
 __________________________________________
/ TASK [mysql_exporter :                   \
\ /etc/default/prometheus-mysqld-exporter] /
 ------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before: /etc/default/prometheus-mysqld-exporter
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/mysql_exporter/files/prometheus-mysqld-exporter
@@ -1,120 +1 @@
-# By default the connection string will be read from
-# $HOME/my.cnf or from the file specified with the -config.my-cnf parameter.
-
-# To set a connection string from the environment instead, uncomment one of the
-# following lines.
-
-# Using UNIX domain sockets and authentication:
-# DATA_SOURCE_NAME="prometheus:nopassword@unix(/run/mysqld/mysqld.sock)/"
-
-# Using a TCP connection and password authentication:
-# DATA_SOURCE_NAME="login:password@(hostname:port)/dbname"
-
-# Note the user must be granted enough privileges for the exporter to run.
-# Example to create a user to connect with the UNIX socket:
-#
-#  CREATE USER IF NOT EXISTS 'prometheus'@'localhost' IDENTIFIED VIA unix_socket;
-#  GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'prometheus'@'localhost';
-
-# Set the command-line arguments to pass to the exporter.
-# ARGS='-config.my-cnf /etc/mysql/debian.cnf'
-
-# Usage of prometheus-mysqld-exporter:
-#   -collect.auto_increment.columns
-#     	Collect auto_increment columns and max values from information_schema
-#  --exporter.lock_wait_timeout=2
-#       Set a lock_wait_timeout on the connection to avoid long metadata
-#       locking.
-#  --exporter.log_slow_filter
-#       Add a log_slow_filter to avoid slow query logging of scrapes. NOTE: Not
-#       supported by Oracle MySQL.
-#  --collect.heartbeat.database="heartbeat"
-#       Database from where to collect heartbeat data
-#  --collect.heartbeat.table="heartbeat"
-#       Table from where to collect heartbeat data
-#  --collect.info_schema.processlist.min_time=0
-#       Minimum time a thread must be in each state to be counted
-#  --collect.info_schema.tables.databases="*"
-#       The list of databases to collect table stats for, or '*' for all
-#  --collect.perf_schema.eventsstatements.limit=250
-#       Limit the number of events statements digests by response time
-#  --collect.perf_schema.eventsstatements.timelimit=86400
-#       Limit how old the 'last_seen' events statements can be, in seconds
-#  --collect.perf_schema.eventsstatements.digest_text_limit=120
-#       Maximum length of the normalized statement text
-#  --collect.perf_schema.file_instances.filter=".*"
-#       RegEx file_name filter for performance_schema.file_summary_by_instance
-#  --collect.perf_schema.file_instances.remove_prefix="/var/lib/mysql/"
-#       Remove path prefix in performance_schema.file_summary_by_instance
-#  --web.listen-address=":9104"
-#       Address to listen on for web interface and telemetry.
-#  --web.telemetry-path="/metrics"
-#       Path under which to expose metrics.
-#  --config.my-cnf="$HOME/.my.cnf"
-#       Path to .my.cnf file to read MySQL credentials from.
-#  --collect.global_variables
-#       Collect from SHOW GLOBAL VARIABLES
-#  --collect.slave_status
-#       Collect from SHOW SLAVE STATUS
-#  --collect.info_schema.processlist
-#       Collect current thread state counts from the
-#       information_schema.processlist
-#  --collect.info_schema.tables
-#       Collect metrics from information_schema.tables
-#  --collect.info_schema.innodb_tablespaces
-#       Collect metrics from information_schema.innodb_sys_tablespaces
-#  --collect.info_schema.innodb_metrics
-#       Collect metrics from information_schema.innodb_metrics
-#  --collect.auto_increment.columns
-#       Collect auto_increment columns and max values from information_schema
-#  --collect.global_status
-#       Collect from SHOW GLOBAL STATUS
-#  --collect.perf_schema.tableiowaits
-#       Collect metrics from performance_schema.table_io_waits_summary_by_table
-#  --collect.perf_schema.indexiowaits
-#       Collect metrics from
-#       performance_schema.table_io_waits_summary_by_index_usage
-#  --collect.perf_schema.tablelocks
-#       Collect metrics from
-#       performance_schema.table_lock_waits_summary_by_table
-#  --collect.perf_schema.eventsstatements
-#       Collect metrics from
-#       performance_schema.events_statements_summary_by_digest
-#  --collect.perf_schema.eventswaits
-#       Collect metrics from
-#       performance_schema.events_waits_summary_global_by_event_name
-#  --collect.perf_schema.file_events
-#       Collect metrics from performance_schema.file_summary_by_event_name
-#  --collect.perf_schema.file_instances
-#       Collect metrics from performance_schema.file_summary_by_instance
-#  --collect.binlog_size
-#       Collect the current size of all registered binlog files
-#  --collect.info_schema.userstats
-#       If running with userstat=1, set to true to collect user statistics
-#  --collect.info_schema.clientstats
-#       If running with userstat=1, set to true to collect client statistics
-#  --collect.info_schema.tablestats
-#       If running with userstat=1, set to true to collect table statistics
-#  --collect.info_schema.innodb_cmp
-#       Collect metrics from information_schema.innodb_cmp
-#  --collect.info_schema.innodb_cmpmem
-#       Collect metrics from information_schema.innodb_cmpmem
-#  --collect.info_schema.query_response_time
-#       Collect query response time distribution if query_response_time_stats
-#       is ON.
-#  --collect.engine_tokudb_status
-#       Collect from SHOW ENGINE TOKUDB STATUS
-#  --collect.perf_schema.replication_group_member_stats
-#       Collect metrics from performance_schema.replication_group_member_stats
-#  --collect.heartbeat
-#       Collect from heartbeat
-#  --collect.slave_hosts
-#       Scrape information from 'SHOW SLAVE HOSTS'
-#  --collect.engine_innodb_status
-#       Collect from SHOW ENGINE INNODB STATUS
-#  --log.level="info"
-#       Only log messages with the given severity or above. Valid levels:
-#       [debug, info, warn, error, fatal]
-#  --log.format="logger:stderr"
-#       Set the log target and format. Example:
-#       "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+ARGS="--collect.slave_status"

changed: [manmanmano-3]
--- before: /etc/default/prometheus-mysqld-exporter
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/mysql_exporter/files/prometheus-mysqld-exporter
@@ -1,120 +1 @@
-# By default the connection string will be read from
-# $HOME/my.cnf or from the file specified with the -config.my-cnf parameter.
-
-# To set a connection string from the environment instead, uncomment one of the
-# following lines.
-
-# Using UNIX domain sockets and authentication:
-# DATA_SOURCE_NAME="prometheus:nopassword@unix(/run/mysqld/mysqld.sock)/"
-
-# Using a TCP connection and password authentication:
-# DATA_SOURCE_NAME="login:password@(hostname:port)/dbname"
-
-# Note the user must be granted enough privileges for the exporter to run.
-# Example to create a user to connect with the UNIX socket:
-#
-#  CREATE USER IF NOT EXISTS 'prometheus'@'localhost' IDENTIFIED VIA unix_socket;
-#  GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'prometheus'@'localhost';
-
-# Set the command-line arguments to pass to the exporter.
-# ARGS='-config.my-cnf /etc/mysql/debian.cnf'
-
-# Usage of prometheus-mysqld-exporter:
-#   -collect.auto_increment.columns
-#     	Collect auto_increment columns and max values from information_schema
-#  --exporter.lock_wait_timeout=2
-#       Set a lock_wait_timeout on the connection to avoid long metadata
-#       locking.
-#  --exporter.log_slow_filter
-#       Add a log_slow_filter to avoid slow query logging of scrapes. NOTE: Not
-#       supported by Oracle MySQL.
-#  --collect.heartbeat.database="heartbeat"
-#       Database from where to collect heartbeat data
-#  --collect.heartbeat.table="heartbeat"
-#       Table from where to collect heartbeat data
-#  --collect.info_schema.processlist.min_time=0
-#       Minimum time a thread must be in each state to be counted
-#  --collect.info_schema.tables.databases="*"
-#       The list of databases to collect table stats for, or '*' for all
-#  --collect.perf_schema.eventsstatements.limit=250
-#       Limit the number of events statements digests by response time
-#  --collect.perf_schema.eventsstatements.timelimit=86400
-#       Limit how old the 'last_seen' events statements can be, in seconds
-#  --collect.perf_schema.eventsstatements.digest_text_limit=120
-#       Maximum length of the normalized statement text
-#  --collect.perf_schema.file_instances.filter=".*"
-#       RegEx file_name filter for performance_schema.file_summary_by_instance
-#  --collect.perf_schema.file_instances.remove_prefix="/var/lib/mysql/"
-#       Remove path prefix in performance_schema.file_summary_by_instance
-#  --web.listen-address=":9104"
-#       Address to listen on for web interface and telemetry.
-#  --web.telemetry-path="/metrics"
-#       Path under which to expose metrics.
-#  --config.my-cnf="$HOME/.my.cnf"
-#       Path to .my.cnf file to read MySQL credentials from.
-#  --collect.global_variables
-#       Collect from SHOW GLOBAL VARIABLES
-#  --collect.slave_status
-#       Collect from SHOW SLAVE STATUS
-#  --collect.info_schema.processlist
-#       Collect current thread state counts from the
-#       information_schema.processlist
-#  --collect.info_schema.tables
-#       Collect metrics from information_schema.tables
-#  --collect.info_schema.innodb_tablespaces
-#       Collect metrics from information_schema.innodb_sys_tablespaces
-#  --collect.info_schema.innodb_metrics
-#       Collect metrics from information_schema.innodb_metrics
-#  --collect.auto_increment.columns
-#       Collect auto_increment columns and max values from information_schema
-#  --collect.global_status
-#       Collect from SHOW GLOBAL STATUS
-#  --collect.perf_schema.tableiowaits
-#       Collect metrics from performance_schema.table_io_waits_summary_by_table
-#  --collect.perf_schema.indexiowaits
-#       Collect metrics from
-#       performance_schema.table_io_waits_summary_by_index_usage
-#  --collect.perf_schema.tablelocks
-#       Collect metrics from
-#       performance_schema.table_lock_waits_summary_by_table
-#  --collect.perf_schema.eventsstatements
-#       Collect metrics from
-#       performance_schema.events_statements_summary_by_digest
-#  --collect.perf_schema.eventswaits
-#       Collect metrics from
-#       performance_schema.events_waits_summary_global_by_event_name
-#  --collect.perf_schema.file_events
-#       Collect metrics from performance_schema.file_summary_by_event_name
-#  --collect.perf_schema.file_instances
-#       Collect metrics from performance_schema.file_summary_by_instance
-#  --collect.binlog_size
-#       Collect the current size of all registered binlog files
-#  --collect.info_schema.userstats
-#       If running with userstat=1, set to true to collect user statistics
-#  --collect.info_schema.clientstats
-#       If running with userstat=1, set to true to collect client statistics
-#  --collect.info_schema.tablestats
-#       If running with userstat=1, set to true to collect table statistics
-#  --collect.info_schema.innodb_cmp
-#       Collect metrics from information_schema.innodb_cmp
-#  --collect.info_schema.innodb_cmpmem
-#       Collect metrics from information_schema.innodb_cmpmem
-#  --collect.info_schema.query_response_time
-#       Collect query response time distribution if query_response_time_stats
-#       is ON.
-#  --collect.engine_tokudb_status
-#       Collect from SHOW ENGINE TOKUDB STATUS
-#  --collect.perf_schema.replication_group_member_stats
-#       Collect metrics from performance_schema.replication_group_member_stats
-#  --collect.heartbeat
-#       Collect from heartbeat
-#  --collect.slave_hosts
-#       Scrape information from 'SHOW SLAVE HOSTS'
-#  --collect.engine_innodb_status
-#       Collect from SHOW ENGINE INNODB STATUS
-#  --log.level="info"
-#       Only log messages with the given severity or above. Valid levels:
-#       [debug, info, warn, error, fatal]
-#  --log.format="logger:stderr"
-#       Set the log target and format. Example:
-#       "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+ARGS="--collect.slave_status"

changed: [manmanmano-1]
--- before: /etc/default/prometheus-mysqld-exporter
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/mysql_exporter/files/prometheus-mysqld-exporter
@@ -1,120 +1 @@
-# By default the connection string will be read from
-# $HOME/my.cnf or from the file specified with the -config.my-cnf parameter.
-
-# To set a connection string from the environment instead, uncomment one of the
-# following lines.
-
-# Using UNIX domain sockets and authentication:
-# DATA_SOURCE_NAME="prometheus:nopassword@unix(/run/mysqld/mysqld.sock)/"
-
-# Using a TCP connection and password authentication:
-# DATA_SOURCE_NAME="login:password@(hostname:port)/dbname"
-
-# Note the user must be granted enough privileges for the exporter to run.
-# Example to create a user to connect with the UNIX socket:
-#
-#  CREATE USER IF NOT EXISTS 'prometheus'@'localhost' IDENTIFIED VIA unix_socket;
-#  GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'prometheus'@'localhost';
-
-# Set the command-line arguments to pass to the exporter.
-# ARGS='-config.my-cnf /etc/mysql/debian.cnf'
-
-# Usage of prometheus-mysqld-exporter:
-#   -collect.auto_increment.columns
-#     	Collect auto_increment columns and max values from information_schema
-#  --exporter.lock_wait_timeout=2
-#       Set a lock_wait_timeout on the connection to avoid long metadata
-#       locking.
-#  --exporter.log_slow_filter
-#       Add a log_slow_filter to avoid slow query logging of scrapes. NOTE: Not
-#       supported by Oracle MySQL.
-#  --collect.heartbeat.database="heartbeat"
-#       Database from where to collect heartbeat data
-#  --collect.heartbeat.table="heartbeat"
-#       Table from where to collect heartbeat data
-#  --collect.info_schema.processlist.min_time=0
-#       Minimum time a thread must be in each state to be counted
-#  --collect.info_schema.tables.databases="*"
-#       The list of databases to collect table stats for, or '*' for all
-#  --collect.perf_schema.eventsstatements.limit=250
-#       Limit the number of events statements digests by response time
-#  --collect.perf_schema.eventsstatements.timelimit=86400
-#       Limit how old the 'last_seen' events statements can be, in seconds
-#  --collect.perf_schema.eventsstatements.digest_text_limit=120
-#       Maximum length of the normalized statement text
-#  --collect.perf_schema.file_instances.filter=".*"
-#       RegEx file_name filter for performance_schema.file_summary_by_instance
-#  --collect.perf_schema.file_instances.remove_prefix="/var/lib/mysql/"
-#       Remove path prefix in performance_schema.file_summary_by_instance
-#  --web.listen-address=":9104"
-#       Address to listen on for web interface and telemetry.
-#  --web.telemetry-path="/metrics"
-#       Path under which to expose metrics.
-#  --config.my-cnf="$HOME/.my.cnf"
-#       Path to .my.cnf file to read MySQL credentials from.
-#  --collect.global_variables
-#       Collect from SHOW GLOBAL VARIABLES
-#  --collect.slave_status
-#       Collect from SHOW SLAVE STATUS
-#  --collect.info_schema.processlist
-#       Collect current thread state counts from the
-#       information_schema.processlist
-#  --collect.info_schema.tables
-#       Collect metrics from information_schema.tables
-#  --collect.info_schema.innodb_tablespaces
-#       Collect metrics from information_schema.innodb_sys_tablespaces
-#  --collect.info_schema.innodb_metrics
-#       Collect metrics from information_schema.innodb_metrics
-#  --collect.auto_increment.columns
-#       Collect auto_increment columns and max values from information_schema
-#  --collect.global_status
-#       Collect from SHOW GLOBAL STATUS
-#  --collect.perf_schema.tableiowaits
-#       Collect metrics from performance_schema.table_io_waits_summary_by_table
-#  --collect.perf_schema.indexiowaits
-#       Collect metrics from
-#       performance_schema.table_io_waits_summary_by_index_usage
-#  --collect.perf_schema.tablelocks
-#       Collect metrics from
-#       performance_schema.table_lock_waits_summary_by_table
-#  --collect.perf_schema.eventsstatements
-#       Collect metrics from
-#       performance_schema.events_statements_summary_by_digest
-#  --collect.perf_schema.eventswaits
-#       Collect metrics from
-#       performance_schema.events_waits_summary_global_by_event_name
-#  --collect.perf_schema.file_events
-#       Collect metrics from performance_schema.file_summary_by_event_name
-#  --collect.perf_schema.file_instances
-#       Collect metrics from performance_schema.file_summary_by_instance
-#  --collect.binlog_size
-#       Collect the current size of all registered binlog files
-#  --collect.info_schema.userstats
-#       If running with userstat=1, set to true to collect user statistics
-#  --collect.info_schema.clientstats
-#       If running with userstat=1, set to true to collect client statistics
-#  --collect.info_schema.tablestats
-#       If running with userstat=1, set to true to collect table statistics
-#  --collect.info_schema.innodb_cmp
-#       Collect metrics from information_schema.innodb_cmp
-#  --collect.info_schema.innodb_cmpmem
-#       Collect metrics from information_schema.innodb_cmpmem
-#  --collect.info_schema.query_response_time
-#       Collect query response time distribution if query_response_time_stats
-#       is ON.
-#  --collect.engine_tokudb_status
-#       Collect from SHOW ENGINE TOKUDB STATUS
-#  --collect.perf_schema.replication_group_member_stats
-#       Collect metrics from performance_schema.replication_group_member_stats
-#  --collect.heartbeat
-#       Collect from heartbeat
-#  --collect.slave_hosts
-#       Scrape information from 'SHOW SLAVE HOSTS'
-#  --collect.engine_innodb_status
-#       Collect from SHOW ENGINE INNODB STATUS
-#  --log.level="info"
-#       Only log messages with the given severity or above. Valid levels:
-#       [debug, info, warn, error, fatal]
-#  --log.format="logger:stderr"
-#       Set the log target and format. Example:
-#       "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+ARGS="--collect.slave_status"

changed: [manmanmano-2]
 _________________________________
< TASK [mysql_exporter : service] >
 ---------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-3]
changed: [manmanmano-1]
changed: [manmanmano-2]
 __________________________________________________________
< TASK [mysql_backup : Create a directory for user backup] >
 ----------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [manmanmano-2]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [manmanmano-1]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [manmanmano-3]
 _____________________________________
< TASK [mysql_backup : backup my.cnf] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-1]
changed: [manmanmano-2]
changed: [manmanmano-3]
 _________________________________________
< TASK [mysql_backup : MySQL user backup] >
 -----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-3]
changed: [manmanmano-2]
changed: [manmanmano-1]
 _____________________________________
< TASK [mysql_backup : MySQL crontab] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpars248xb/mysql-backup.j2
@@ -0,0 +1,3 @@
+00 00 * * * backup mysqldump agama > /home/backup/mysql/agama.sql
+10 00 * * 0 backup duplicity --no-encryption full /home/backup/mysql/ rsync://manmanmano@backup.clounsible.mano//home/manmanmano/mysql/
+10 00 * * 1-6 backup duplicity --no-encryption incremental /home/backup/mysql/ rsync://manmanmano@backup.clounsible.mano//home/manmanmano/mysql/

changed: [manmanmano-3]
--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpipza9znd/mysql-backup.j2
@@ -0,0 +1,3 @@
+00 00 * * * backup mysqldump agama > /home/backup/mysql/agama.sql
+10 00 * * 0 backup duplicity --no-encryption full /home/backup/mysql/ rsync://manmanmano@backup.clounsible.mano//home/manmanmano/mysql/
+10 00 * * 1-6 backup duplicity --no-encryption incremental /home/backup/mysql/ rsync://manmanmano@backup.clounsible.mano//home/manmanmano/mysql/

changed: [manmanmano-1]
--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmp_x4yo0wk/mysql-backup.j2
@@ -0,0 +1 @@
+

changed: [manmanmano-2]
 ______________________________________________
< RUNNING HANDLER [mysql : Reset MySQL source] >
 ----------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-3] => (item=stopreplica) 
skipping: [manmanmano-3] => (item=resetprimary) 
skipping: [manmanmano-1] => (item=stopreplica) 
skipping: [manmanmano-1] => (item=resetprimary) 
ok: [manmanmano-2] => (item=stopreplica)
changed: [manmanmano-2] => (item=resetprimary)
 _______________________________________________
< RUNNING HANDLER [mysql : Reset MySQL replica] >
 -----------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-2] => (item=stopreplica) 
skipping: [manmanmano-2] => (item=changeprimary) 
skipping: [manmanmano-2] => (item=resetreplica) 
skipping: [manmanmano-2] => (item=startreplica) 
ok: [manmanmano-3] => (item=stopreplica)
ok: [manmanmano-1] => (item=stopreplica)
changed: [manmanmano-1] => (item=changeprimary)
changed: [manmanmano-3] => (item=changeprimary)
changed: [manmanmano-1] => (item=resetreplica)
changed: [manmanmano-3] => (item=resetreplica)
changed: [manmanmano-1] => (item=startreplica)
changed: [manmanmano-3] => (item=startreplica)
 ___________________________________________________________
< RUNNING HANDLER [mysql_exporter : Restart mysql-exporter] >
 -----------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-1]
changed: [manmanmano-3]
changed: [manmanmano-2]
 ________________________________________________
< RUNNING HANDLER [mysql_backup : Restart MySQL] >
 ------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-1]
changed: [manmanmano-3]
changed: [manmanmano-2]
 ______________
< PLAY [NGINX] >
 --------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ____________________________________________
< TASK [nginx : Install the package "nginx"] >
 --------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx nginx-common nginx-core
0 upgraded, 17 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-2]
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx nginx-common nginx-core
0 upgraded, 17 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-3]
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx nginx-common nginx-core
0 upgraded, 17 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-1]
 ___________________________________
/ TASK [nginx : Copy default to     \
\ /etc/nginx/sites-enabled/default] /
 -----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before: /etc/nginx/sites-enabled/default
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpk_oexkli/default.j2
@@ -1,91 +1,37 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
+server {
+        listen 80 default_server;
+        server_name manmanmano;
 
-# Default server configuration
-#
-server {
-	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
-	server_name _;
-
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
-	}
-
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
-}
+        location / {
+            proxy_pass http://localhost:8001;
+            proxy_set_header Host $http_host;
+        }
 
 
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+
+        location /haproxy-metrics {
+            proxy_pass http://localhost:9101/metrics;
+        }
+
+        location /keepalived-metrics {
+            proxy_pass http://localhost:9165/metrics;
+        }
+
+
+        location /mysql-metrics {
+            proxy_pass http://localhost:9104/metrics;
+        }
+
+        location /bind-metrics {
+            proxy_pass http://localhost:9119/metrics;
+        }
+
+        location /node-metrics {
+            proxy_pass http://localhost:9100/metrics;
+        }
+
+        location /nginx-metrics {
+            proxy_pass http://localhost:9113/metrics;
+        }
+
+}

changed: [manmanmano-3]
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpv4ulebp0/default.j2
@@ -1,91 +1,46 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
+server {
+        listen 80 default_server;
+        server_name manmanmano;
 
-# Default server configuration
-#
-server {
-	listen 80 default_server;
-	listen [::]:80 default_server;
+        location / {
+            proxy_pass http://localhost:8001;
+            proxy_set_header Host $http_host;
+        }
 
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
+        location /prometheus {
+            proxy_pass http://localhost:9090;
+        }
 
-	root /var/www/html;
+        location /grafana {
+            proxy_pass http://localhost:3001;
+        }
 
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
+        location /haproxy-metrics {
+            proxy_pass http://localhost:9101/metrics;
+        }
 
-	server_name _;
+        location /keepalived-metrics {
+            proxy_pass http://localhost:9165/metrics;
+        }
 
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
-	}
+        location /influxdb-metrics {
+            proxy_pass http://localhost:9424/metrics;
+        }
 
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
+        location /mysql-metrics {
+            proxy_pass http://localhost:9104/metrics;
+        }
 
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
+        location /bind-metrics {
+            proxy_pass http://localhost:9119/metrics;
+        }
+
+        location /node-metrics {
+            proxy_pass http://localhost:9100/metrics;
+        }
+
+        location /nginx-metrics {
+            proxy_pass http://localhost:9113/metrics;
+        }
+
 }
-
-
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}

changed: [manmanmano-2]
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpo8z_6eiq/default.j2
@@ -1,91 +1,37 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
+server {
+        listen 80 default_server;
+        server_name manmanmano;
 
-# Default server configuration
-#
-server {
-	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
-	server_name _;
-
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
-	}
-
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
-}
+        location / {
+            proxy_pass http://localhost:8001;
+            proxy_set_header Host $http_host;
+        }
 
 
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+
+        location /haproxy-metrics {
+            proxy_pass http://localhost:9101/metrics;
+        }
+
+        location /keepalived-metrics {
+            proxy_pass http://localhost:9165/metrics;
+        }
+
+
+        location /mysql-metrics {
+            proxy_pass http://localhost:9104/metrics;
+        }
+
+        location /bind-metrics {
+            proxy_pass http://localhost:9119/metrics;
+        }
+
+        location /node-metrics {
+            proxy_pass http://localhost:9100/metrics;
+        }
+
+        location /nginx-metrics {
+            proxy_pass http://localhost:9113/metrics;
+        }
+
+}

changed: [manmanmano-1]
 ______________________________
< TASK [nginx : Nginx service] >
 ------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 ________________________________________________
< TASK [nginx_exporter : Install nginx-exporter] >
 ------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-3]
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-2]
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-1]
 ________________________________________________
< TASK [nginx_exporter : Service nginx-exporter] >
 ------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-3]
changed: [manmanmano-2]
changed: [manmanmano-1]
 _______________________________________
< TASK [nginx_exporter : exporter file] >
 ---------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/nginx_exporter/files/exporter
@@ -0,0 +1,6 @@
+server {
+    listen 8080 default_server;
+    location = /stub_status {
+        stub_status;
+    }
+}

changed: [manmanmano-3]
--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/nginx_exporter/files/exporter
@@ -0,0 +1,6 @@
+server {
+    listen 8080 default_server;
+    location = /stub_status {
+        stub_status;
+    }
+}

changed: [manmanmano-1]
--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/nginx_exporter/files/exporter
@@ -0,0 +1,6 @@
+server {
+    listen 8080 default_server;
+    location = /stub_status {
+        stub_status;
+    }
+}

changed: [manmanmano-2]
 __________________________________________________
< RUNNING HANDLER [nginx_exporter : Restart Nginx] >
 --------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-1]
changed: [manmanmano-3]
changed: [manmanmano-2]
 ___________________________________________________________
< RUNNING HANDLER [nginx_exporter : Restart nginx-exporter] >
 -----------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-3]
changed: [manmanmano-1]
changed: [manmanmano-2]
 ______________________________
< PLAY [Haproxy and Keepalive] >
 ------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 __________________________________
< TASK [haproxy : Install HAProxy] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


The following additional packages will be installed:
  liblua5.3-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.3-0
0 upgraded, 2 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-1]
The following additional packages will be installed:
  liblua5.3-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.3-0
0 upgraded, 2 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-2]
The following additional packages will be installed:
  liblua5.3-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.3-0
0 upgraded, 2 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-3]
 _________________________________
< TASK [haproxy : haproxy config] >
 ---------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before: /etc/haproxy/haproxy.cfg
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpzwqysh2x/haproxy.cfg.j2
@@ -7,15 +7,6 @@
 	user haproxy
 	group haproxy
 	daemon
-
-	# Default SSL material locations
-	ca-base /etc/ssl/certs
-	crt-base /etc/ssl/private
-
-	# See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
-        ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
-        ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
-        ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
 
 defaults
 	log	global
@@ -32,3 +23,15 @@
 	errorfile 502 /etc/haproxy/errors/502.http
 	errorfile 503 /etc/haproxy/errors/503.http
 	errorfile 504 /etc/haproxy/errors/504.http
+
+
+listen clounsible.mano 
+   bind *:88
+   stats enable
+   stats uri /stats
+   server lb1-docker1 lb1:8001 check
+   server lb1-docker2 lb1:8010 check
+   server lb2-docker1 lb2:8001 check
+   server lb2-docker2 lb2:8010 check
+   server lb3-docker1 lb3:8001 check
+   server lb3-docker2 lb3:8010 check

changed: [manmanmano-2]
--- before: /etc/haproxy/haproxy.cfg
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmp1bsmxl_g/haproxy.cfg.j2
@@ -7,15 +7,6 @@
 	user haproxy
 	group haproxy
 	daemon
-
-	# Default SSL material locations
-	ca-base /etc/ssl/certs
-	crt-base /etc/ssl/private
-
-	# See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
-        ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
-        ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
-        ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
 
 defaults
 	log	global
@@ -32,3 +23,15 @@
 	errorfile 502 /etc/haproxy/errors/502.http
 	errorfile 503 /etc/haproxy/errors/503.http
 	errorfile 504 /etc/haproxy/errors/504.http
+
+
+listen clounsible.mano 
+   bind *:88
+   stats enable
+   stats uri /stats
+   server lb1-docker1 lb1:8001 check
+   server lb1-docker2 lb1:8010 check
+   server lb2-docker1 lb2:8001 check
+   server lb2-docker2 lb2:8010 check
+   server lb3-docker1 lb3:8001 check
+   server lb3-docker2 lb3:8010 check

changed: [manmanmano-3]
--- before: /etc/haproxy/haproxy.cfg
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmphev76yzl/haproxy.cfg.j2
@@ -7,15 +7,6 @@
 	user haproxy
 	group haproxy
 	daemon
-
-	# Default SSL material locations
-	ca-base /etc/ssl/certs
-	crt-base /etc/ssl/private
-
-	# See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
-        ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
-        ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
-        ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
 
 defaults
 	log	global
@@ -32,3 +23,15 @@
 	errorfile 502 /etc/haproxy/errors/502.http
 	errorfile 503 /etc/haproxy/errors/503.http
 	errorfile 504 /etc/haproxy/errors/504.http
+
+
+listen clounsible.mano 
+   bind *:88
+   stats enable
+   stats uri /stats
+   server lb1-docker1 lb1:8001 check
+   server lb1-docker2 lb1:8010 check
+   server lb2-docker1 lb2:8001 check
+   server lb2-docker2 lb2:8010 check
+   server lb3-docker1 lb3:8001 check
+   server lb3-docker2 lb3:8010 check

changed: [manmanmano-1]
 __________________________________
< TASK [haproxy : Service haproxy] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ____________________________________________________
< TASK [haproxy_exporter : Install haproxy exporter] >
 ----------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-2]
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-1]
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-3]
 ___________________________________________________
< TASK [haproxy_exporter : haproxy exporter config] >
 ---------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before: /etc/default/prometheus-haproxy-exporter
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpwch2qc3n/prometheus-haproxy-exporter.j2
@@ -2,7 +2,7 @@
 # Due to shell scaping, to pass backslashes for regexes, you need to double
 # them (\\d for \d). If running under systemd, you need to double them again
 # (\\\\d to mean \d), and escape newlines too.
-ARGS=""
+ARGS="--haproxy.scrape-uri=http://localhost:88/stats;csv"
 
 # Prometheus-haproxy-exporter supports the following options:
 #
@@ -33,3 +33,4 @@
 #  --log.format="logger:stderr"
 #    Set the log target and format. Example:
 #    "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+

changed: [manmanmano-3]
--- before: /etc/default/prometheus-haproxy-exporter
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmp9gno95_4/prometheus-haproxy-exporter.j2
@@ -2,7 +2,7 @@
 # Due to shell scaping, to pass backslashes for regexes, you need to double
 # them (\\d for \d). If running under systemd, you need to double them again
 # (\\\\d to mean \d), and escape newlines too.
-ARGS=""
+ARGS="--haproxy.scrape-uri=http://localhost:88/stats;csv"
 
 # Prometheus-haproxy-exporter supports the following options:
 #
@@ -33,3 +33,4 @@
 #  --log.format="logger:stderr"
 #    Set the log target and format. Example:
 #    "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+

changed: [manmanmano-1]
--- before: /etc/default/prometheus-haproxy-exporter
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpl87ydr3t/prometheus-haproxy-exporter.j2
@@ -2,7 +2,7 @@
 # Due to shell scaping, to pass backslashes for regexes, you need to double
 # them (\\d for \d). If running under systemd, you need to double them again
 # (\\\\d to mean \d), and escape newlines too.
-ARGS=""
+ARGS="--haproxy.scrape-uri=http://localhost:88/stats;csv"
 
 # Prometheus-haproxy-exporter supports the following options:
 #
@@ -33,3 +33,4 @@
 #  --log.format="logger:stderr"
 #    Set the log target and format. Example:
 #    "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+

changed: [manmanmano-2]
 __________________________________
/ TASK [haproxy_exporter : Service \
\ prometheus-haproxy-exporter]     /
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 ________________________________________
< TASK [keepalived : Install keepalived] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


The following additional packages will be installed:
  ipvsadm libmysqlclient21 libnl-3-200 libnl-genl-3-200 libsensors-config
  libsensors5 libsnmp-base libsnmp35
Suggested packages:
  heartbeat ldirectord lm-sensors snmp-mibs-downloader
The following NEW packages will be installed:
  ipvsadm keepalived libmysqlclient21 libnl-3-200 libnl-genl-3-200
  libsensors-config libsensors5 libsnmp-base libsnmp35
0 upgraded, 9 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-3]
The following additional packages will be installed:
  ipvsadm libmysqlclient21 libnl-3-200 libnl-genl-3-200 libsensors-config
  libsensors5 libsnmp-base libsnmp35
Suggested packages:
  heartbeat ldirectord lm-sensors snmp-mibs-downloader
The following NEW packages will be installed:
  ipvsadm keepalived libmysqlclient21 libnl-3-200 libnl-genl-3-200
  libsensors-config libsensors5 libsnmp-base libsnmp35
0 upgraded, 9 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-1]
The following additional packages will be installed:
  ipvsadm libmysqlclient21 libnl-3-200 libnl-genl-3-200 libsensors-config
  libsensors5 libsnmp-base libsnmp35
Suggested packages:
  heartbeat ldirectord lm-sensors snmp-mibs-downloader
The following NEW packages will be installed:
  ipvsadm keepalived libmysqlclient21 libnl-3-200 libnl-genl-3-200
  libsensors-config libsensors5 libsnmp-base libsnmp35
0 upgraded, 9 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-2]
 _______________________________________
< TASK [keepalived : keepalived script] >
 ---------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpkjvlo7b8/ha88.j2
@@ -0,0 +1,2 @@
+#!/bin/bash
+ss -ntl | grep -q ':88 '

changed: [manmanmano-1]
--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpvh7u450s/ha88.j2
@@ -0,0 +1,2 @@
+#!/bin/bash
+ss -ntl | grep -q ':88 '

changed: [manmanmano-3]
--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmplcj8dh6v/ha88.j2
@@ -0,0 +1,2 @@
+#!/bin/bash
+ss -ntl | grep -q ':88 '

changed: [manmanmano-2]
 _____________________________________
< TASK [keepalived : keepalived.conf] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmp4ven7txx/keepalived.conf.j2
@@ -0,0 +1,21 @@
+vrrp_script check_haproxy {                 
+    script "/usr/local/bin/ha88" 
+    weight 20                              
+    interval 1               
+}
+vrrp_instance clounsible.mano {             
+    interface ens3
+    virtual_router_id 1 
+        priority 99
+        advert_int 1                            
+    virtual_ipaddress {                     
+        192.168.100.115/24                   
+    }
+    unicast_peer {                          
+                        192.168.42.115
+                                                192.168.42.126
+                    }
+    track_script {
+        check_haproxy
+    }
+}

changed: [manmanmano-2]
--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpyb8g99pd/keepalived.conf.j2
@@ -0,0 +1,21 @@
+vrrp_script check_haproxy {                 
+    script "/usr/local/bin/ha88" 
+    weight 20                              
+    interval 1               
+}
+vrrp_instance clounsible.mano {             
+    interface ens3
+    virtual_router_id 1 
+        priority 99
+        advert_int 1                            
+    virtual_ipaddress {                     
+        192.168.100.115/24                   
+    }
+    unicast_peer {                          
+                        192.168.42.115
+                                192.168.42.50
+                                    }
+    track_script {
+        check_haproxy
+    }
+}

changed: [manmanmano-3]
--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpmm0xl1h_/keepalived.conf.j2
@@ -0,0 +1,21 @@
+vrrp_script check_haproxy {                 
+    script "/usr/local/bin/ha88" 
+    weight 20                              
+    interval 1               
+}
+vrrp_instance clounsible.mano {             
+    interface ens3
+    virtual_router_id 1 
+        priority 100
+        advert_int 1                            
+    virtual_ipaddress {                     
+        192.168.100.115/24                   
+    }
+    unicast_peer {                          
+                                        192.168.42.50
+                                192.168.42.126
+                    }
+    track_script {
+        check_haproxy
+    }
+}

changed: [manmanmano-1]
 ________________________________________
< TASK [keepalived : Service keepalived] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1] => (item=haproxy)
ok: [manmanmano-3] => (item=haproxy)
ok: [manmanmano-2] => (item=haproxy)
changed: [manmanmano-3] => (item=keepalived)
changed: [manmanmano-2] => (item=keepalived)
changed: [manmanmano-1] => (item=keepalived)
 ______________________________________________________
/ TASK [keepalived_exporter : Copy keepalived-exporter \
\ binary]                                              /
 ------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


diff skipped: source file size is greater than 104448
changed: [manmanmano-1]
diff skipped: source file size is greater than 104448
changed: [manmanmano-2]
diff skipped: source file size is greater than 104448
changed: [manmanmano-3]
 __________________________________
/ TASK [keepalived_exporter : Copy \
\ keepalived-exporter.service]     /
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/keepalived_exporter/files/keepalived-exporter.service
@@ -0,0 +1,11 @@
+[Unit]                                                                          
+Description=prometheus-keepalived-exporter for keepalived metrics
+Documentation=https://github.com/cafebazaar/keepalived-exporter
+After=network-online.target                                                     
+                                                                                
+[Service]                                                                       
+User=root                                                                     
+ExecStart=/usr/local/bin/prometheus-keepalived-exporter
+                                                                                
+[Install]                                                                       
+WantedBy=multi-user.target 

changed: [manmanmano-1]
--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/keepalived_exporter/files/keepalived-exporter.service
@@ -0,0 +1,11 @@
+[Unit]                                                                          
+Description=prometheus-keepalived-exporter for keepalived metrics
+Documentation=https://github.com/cafebazaar/keepalived-exporter
+After=network-online.target                                                     
+                                                                                
+[Service]                                                                       
+User=root                                                                     
+ExecStart=/usr/local/bin/prometheus-keepalived-exporter
+                                                                                
+[Install]                                                                       
+WantedBy=multi-user.target 

changed: [manmanmano-3]
--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/keepalived_exporter/files/keepalived-exporter.service
@@ -0,0 +1,11 @@
+[Unit]                                                                          
+Description=prometheus-keepalived-exporter for keepalived metrics
+Documentation=https://github.com/cafebazaar/keepalived-exporter
+After=network-online.target                                                     
+                                                                                
+[Service]                                                                       
+User=root                                                                     
+ExecStart=/usr/local/bin/prometheus-keepalived-exporter
+                                                                                
+[Install]                                                                       
+WantedBy=multi-user.target 

changed: [manmanmano-2]
 __________________________________________________________
< TASK [keepalived_exporter : Keepalived-exporter service] >
 ----------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-1]
changed: [manmanmano-3]
changed: [manmanmano-2]
 _____________________________________________
< RUNNING HANDLER [haproxy : Restart haproxy] >
 ---------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-1]
changed: [manmanmano-3]
changed: [manmanmano-2]
 _____________________________________________
/ RUNNING HANDLER [haproxy_exporter : Restart \
\ haproxy-exporter]                           /
 ---------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-3]
changed: [manmanmano-1]
changed: [manmanmano-2]
 ___________________________________________________
< RUNNING HANDLER [keepalived : Restart keepalived] >
 ---------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2] => (item=keepalived)
changed: [manmanmano-1] => (item=keepalived)
changed: [manmanmano-3] => (item=keepalived)
changed: [manmanmano-3] => (item=haproxy)
changed: [manmanmano-2] => (item=haproxy)
changed: [manmanmano-1] => (item=haproxy)
 ________________________________________________________
< RUNNING HANDLER [keepalived_exporter : Reload daemons] >
 --------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-3]
changed: [manmanmano-2]
changed: [manmanmano-1]
 ________________________________________________
/ RUNNING HANDLER [keepalived_exporter : Restart \
\ keepalived-exporter]                           /
 ------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-1]
changed: [manmanmano-3]
changed: [manmanmano-2]
 ___________________
< PLAY [Docker bug] >
 -------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 _______________________________________________
< TASK [iptables : Install iptables-persistent] >
 -----------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


The following additional packages will be installed:
  netfilter-persistent
The following NEW packages will be installed:
  iptables-persistent netfilter-persistent
0 upgraded, 2 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-1]
The following additional packages will be installed:
  netfilter-persistent
The following NEW packages will be installed:
  iptables-persistent netfilter-persistent
0 upgraded, 2 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-3]
The following additional packages will be installed:
  netfilter-persistent
The following NEW packages will be installed:
  iptables-persistent netfilter-persistent
0 upgraded, 2 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-2]
 __________________________________________
< TASK [iptables : Fix ssl bug for docker] >
 ------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/iptables/files/iptables.mangle
@@ -0,0 +1,13 @@
+# Generated by iptables-save v1.8.4 on Mon Nov 22 11:27:22 2021
+*mangle
+:PREROUTING ACCEPT [48:3360]
+:INPUT ACCEPT [48:3360]
+:FORWARD ACCEPT [0:0]
+:OUTPUT ACCEPT [25:2248]
+:POSTROUTING ACCEPT [25:2248]
+:LIBVIRT_PRT - [0:0]
+-A POSTROUTING -j LIBVIRT_PRT
+-A POSTROUTING -o ens3 -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu
+-A LIBVIRT_PRT -o virbr0 -p udp -m udp --dport 68 -j CHECKSUM --checksum-fill
+COMMIT
+# Completed on Mon Nov 22 11:27:22 2021

changed: [manmanmano-2]
--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/iptables/files/iptables.mangle
@@ -0,0 +1,13 @@
+# Generated by iptables-save v1.8.4 on Mon Nov 22 11:27:22 2021
+*mangle
+:PREROUTING ACCEPT [48:3360]
+:INPUT ACCEPT [48:3360]
+:FORWARD ACCEPT [0:0]
+:OUTPUT ACCEPT [25:2248]
+:POSTROUTING ACCEPT [25:2248]
+:LIBVIRT_PRT - [0:0]
+-A POSTROUTING -j LIBVIRT_PRT
+-A POSTROUTING -o ens3 -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu
+-A LIBVIRT_PRT -o virbr0 -p udp -m udp --dport 68 -j CHECKSUM --checksum-fill
+COMMIT
+# Completed on Mon Nov 22 11:27:22 2021

changed: [manmanmano-3]
--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/iptables/files/iptables.mangle
@@ -0,0 +1,13 @@
+# Generated by iptables-save v1.8.4 on Mon Nov 22 11:27:22 2021
+*mangle
+:PREROUTING ACCEPT [48:3360]
+:INPUT ACCEPT [48:3360]
+:FORWARD ACCEPT [0:0]
+:OUTPUT ACCEPT [25:2248]
+:POSTROUTING ACCEPT [25:2248]
+:LIBVIRT_PRT - [0:0]
+-A POSTROUTING -j LIBVIRT_PRT
+-A POSTROUTING -o ens3 -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu
+-A LIBVIRT_PRT -o virbr0 -p udp -m udp --dport 68 -j CHECKSUM --checksum-fill
+COMMIT
+# Completed on Mon Nov 22 11:27:22 2021

changed: [manmanmano-1]
 ________________________________
< TASK [iptables : Load on boot] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before: /etc/iptables/rules.v4
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/iptables/files/iptables.mangle
@@ -1,7 +1,13 @@
-# Generated by iptables-save v1.8.4 on Thu Dec  9 10:37:03 2021
-*filter
-:INPUT ACCEPT [0:0]
+# Generated by iptables-save v1.8.4 on Mon Nov 22 11:27:22 2021
+*mangle
+:PREROUTING ACCEPT [48:3360]
+:INPUT ACCEPT [48:3360]
 :FORWARD ACCEPT [0:0]
-:OUTPUT ACCEPT [0:0]
+:OUTPUT ACCEPT [25:2248]
+:POSTROUTING ACCEPT [25:2248]
+:LIBVIRT_PRT - [0:0]
+-A POSTROUTING -j LIBVIRT_PRT
+-A POSTROUTING -o ens3 -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu
+-A LIBVIRT_PRT -o virbr0 -p udp -m udp --dport 68 -j CHECKSUM --checksum-fill
 COMMIT
-# Completed on Thu Dec  9 10:37:03 2021
+# Completed on Mon Nov 22 11:27:22 2021

changed: [manmanmano-1]
--- before: /etc/iptables/rules.v4
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/iptables/files/iptables.mangle
@@ -1,7 +1,13 @@
-# Generated by iptables-save v1.8.4 on Thu Dec  9 10:37:03 2021
-*filter
-:INPUT ACCEPT [0:0]
+# Generated by iptables-save v1.8.4 on Mon Nov 22 11:27:22 2021
+*mangle
+:PREROUTING ACCEPT [48:3360]
+:INPUT ACCEPT [48:3360]
 :FORWARD ACCEPT [0:0]
-:OUTPUT ACCEPT [0:0]
+:OUTPUT ACCEPT [25:2248]
+:POSTROUTING ACCEPT [25:2248]
+:LIBVIRT_PRT - [0:0]
+-A POSTROUTING -j LIBVIRT_PRT
+-A POSTROUTING -o ens3 -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu
+-A LIBVIRT_PRT -o virbr0 -p udp -m udp --dport 68 -j CHECKSUM --checksum-fill
 COMMIT
-# Completed on Thu Dec  9 10:37:03 2021
+# Completed on Mon Nov 22 11:27:22 2021

changed: [manmanmano-3]
--- before: /etc/iptables/rules.v4
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/iptables/files/iptables.mangle
@@ -1,7 +1,13 @@
-# Generated by iptables-save v1.8.4 on Thu Dec  9 10:37:04 2021
-*filter
-:INPUT ACCEPT [0:0]
+# Generated by iptables-save v1.8.4 on Mon Nov 22 11:27:22 2021
+*mangle
+:PREROUTING ACCEPT [48:3360]
+:INPUT ACCEPT [48:3360]
 :FORWARD ACCEPT [0:0]
-:OUTPUT ACCEPT [0:0]
+:OUTPUT ACCEPT [25:2248]
+:POSTROUTING ACCEPT [25:2248]
+:LIBVIRT_PRT - [0:0]
+-A POSTROUTING -j LIBVIRT_PRT
+-A POSTROUTING -o ens3 -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu
+-A LIBVIRT_PRT -o virbr0 -p udp -m udp --dport 68 -j CHECKSUM --checksum-fill
 COMMIT
-# Completed on Thu Dec  9 10:37:04 2021
+# Completed on Mon Nov 22 11:27:22 2021

changed: [manmanmano-2]
 ____________________________________
< TASK [iptables : Restore iptables] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


[WARNING]: Attempts to restore iptables state without rollback in case of
mistake may lead the ansible controller to loose access to the hosts and never
regain it before fixing firewall rules through a serial console, or any other
way except SSH. Please set task attribute 'poll' (=15) to 0, and 'async' (=0)
to a value >2 and not greater than 'ansible_timeout' (=10) (recommended).
[WARNING]: Attempts to restore iptables state without rollback in case of
mistake may lead the ansible controller to loose access to the hosts and never
regain it before fixing firewall rules through a serial console, or any other
way except SSH. Please set task attribute 'poll' (=15) to 0, and 'async' (=0)
to a value >2 and not greater than 'ansible_timeout' (=10) (recommended).
[WARNING]: Attempts to restore iptables state without rollback in case of
mistake may lead the ansible controller to loose access to the hosts and never
regain it before fixing firewall rules through a serial console, or any other
way except SSH. Please set task attribute 'poll' (=15) to 0, and 'async' (=0)
to a value >2 and not greater than 'ansible_timeout' (=10) (recommended).
changed: [manmanmano-1]
changed: [manmanmano-2]
changed: [manmanmano-3]
 _______________
< PLAY [Docker] >
 ---------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ________________________________
< TASK [docker : Docker package] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base libidn11 pigz python3-websocket runc
  ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io libidn11 pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 10 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-3]
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base libidn11 pigz python3-websocket runc
  ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io libidn11 pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 10 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-1]
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base libidn11 pigz python3-websocket runc
  ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io libidn11 pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 10 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-2]
 ________________________________
< TASK [docker : Docker service] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 ______________
< PLAY [Agama] >
 --------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ___________________________
< TASK [agama : /opt/agama] >
 ---------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [manmanmano-3]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [manmanmano-1]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [manmanmano-2]
 ____________________________________
< TASK [agama : Download dockerfile] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
changed: [manmanmano-3]
changed: [manmanmano-1]
 ____________________________
< TASK [agama : Agama image] >
 ----------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-3]
changed: [manmanmano-2]
changed: [manmanmano-1]
 _________________________________
< TASK [agama : Agama containers] >
 ---------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [manmanmano-3] => (item={'key': 'agama-1', 'value': 8001})
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [manmanmano-1] => (item={'key': 'agama-1', 'value': 8001})
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [manmanmano-2] => (item={'key': 'agama-1', 'value': 8001})
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [manmanmano-1] => (item={'key': 'agama-2', 'value': 8010})
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [manmanmano-3] => (item={'key': 'agama-2', 'value': 8010})
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [manmanmano-2] => (item={'key': 'agama-2', 'value': 8010})
 ___________________
< PLAY [Prometheus] >
 -------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ________________________________________
< TASK [prometheus : Install Prometheus] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


The following additional packages will be installed:
  fonts-glyphicons-halflings javascript-common libc-ares2 libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libnode64 node-jquery nodejs
  nodejs-doc
Suggested packages:
  npm
The following NEW packages will be installed:
  fonts-glyphicons-halflings javascript-common libc-ares2 libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libnode64 node-jquery nodejs
  nodejs-doc prometheus
0 upgraded, 19 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-2]
 ________________________________________
< TASK [prometheus : Service prometheus] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 _____________________________________
< TASK [prometheus : prometheus.yaml] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before: /etc/prometheus/prometheus.yml
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmp27dewrm8/prometheus.yml.j2
@@ -1,44 +1,59 @@
-# Sample config for Prometheus.
-
 global:
   scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
   evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.
-  # scrape_timeout is set to the global default (10s).
 
-  # Attach these labels to any time series or alerts when communicating with
-  # external systems (federation, remote storage, Alertmanager).
-  external_labels:
-      monitor: 'example'
-
-# Alertmanager configuration
-alerting:
-  alertmanagers:
-  - static_configs:
-    - targets: ['localhost:9093']
-
-# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.
-rule_files:
-  # - "first_rules.yml"
-  # - "second_rules.yml"
-
-# A scrape configuration containing exactly one endpoint to scrape:
-# Here it's Prometheus itself.
 scrape_configs:
-  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.
   - job_name: 'prometheus'
-
-    # Override the global default and scrape targets from this job every 5 seconds.
     scrape_interval: 5s
     scrape_timeout: 5s
-
     # metrics_path defaults to '/metrics'
-    # scheme defaults to 'http'.
-
+    metrics_path: /prometheus/metrics
     static_configs:
       - targets: ['localhost:9090']
 
-  - job_name: node
-    # If prometheus-node-exporter is installed, grab stats about the local
-    # machine by default.
+  - job_name: linux
     static_configs:
-      - targets: ['localhost:9100']
+      - targets:
+        - manmanmano-1:9100
+        - manmanmano-2:9100
+        - manmanmano-3:9100
+
+  - job_name: mysql
+    static_configs:
+      - targets:
+        - mysql1:9104
+        - mysql2:9104
+        - mysql3:9104
+
+  - job_name: bind
+    static_configs:
+      - targets:
+        - ns1:9119
+        - ns2:9119
+        - ns3:9119
+
+  - job_name: nginx 
+    static_configs:
+      - targets:
+        - web1:9113
+        - web2:9113
+        - web3:9113
+
+  - job_name: influxdb
+    static_configs:
+      - targets:
+        - influxdb:9424
+
+  - job_name: haproxy
+    static_configs:
+      - targets:
+        - lb1:9101
+        - lb2:9101
+        - lb3:9101
+
+  - job_name: keepalived
+    static_configs:
+      - targets:
+        - lb1:9165
+        - lb2:9165
+        - lb3:9165

changed: [manmanmano-2]
 _____________________________________________
< TASK [prometheus : /etc/default/prometheus] >
 ---------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before: /etc/default/prometheus
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmpx_535ryv/prometheus.j2
@@ -1,5 +1,5 @@
 # Set the command-line arguments to pass to the server.
-ARGS=""
+ARGS="--web.external-url=http://prometheus:5080/prometheus"
 
 # Prometheus supports the following options:
 #  --config.file="/etc/prometheus/prometheus.yml"
@@ -55,3 +55,4 @@
 #                             Maximum number of queries executed concurrently.
 #  --log.level=info           Only log messages with the given severity or
 #                             above. One of: [debug, info, warn, error]
+

changed: [manmanmano-2]
 ___________________________________________________
< RUNNING HANDLER [prometheus : Restart prometheus] >
 ---------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
 ________________
< PLAY [Grafana] >
 ----------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ____________________________________
< TASK [grafana : Grafana directory] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana",
-    "state": "absent"
+    "state": "directory"
 }

changed: [manmanmano-2]
 ________________________________________
< TASK [grafana : Grafana configuration] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmplv748_2u/grafana.ini.j2
@@ -0,0 +1,54 @@
+[paths]
+
+[security]
+admin_password = grafana
+
+[server]
+root_url = http://193.40.156.86:5080/grafana
+serve_from_sub_path=true
+
+[database]
+[remote_cache]
+[dataproxy]
+[analytics]
+[security]
+[snapshots]
+[dashboards]
+[users]
+[auth]
+[auth.anonymous]
+[auth.github]
+[auth.gitlab]
+[auth.google]
+[auth.grafana_com]
+[auth.azuread]
+[auth.okta]
+[auth.generic_oauth]
+[auth.basic]
+[auth.proxy]
+[auth.ldap]
+[smtp]
+[emails]
+[log]
+[log.console]
+[log.file]
+[log.syslog]
+[quota]
+[alerting]
+[explore]
+[metrics]
+[metrics.graphite]
+[grafana_com]
+[tracing.jaeger]
+[external_image_storage]
+[external_image_storage.s3]
+[external_image_storage.webdav]
+[external_image_storage.gcs]
+[external_image_storage.azure_blob]
+[external_image_storage.local]
+[rendering]
+[panels]
+[plugins]
+[plugin.grafana-image-renderer]
+[enterprise]
+[feature_toggles]

changed: [manmanmano-2]
 ___________________________________________________
< TASK [grafana : Grafana dashboard and datasource] >
 ---------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/dashboards",
-    "state": "absent"
+    "state": "directory"
 }

changed: [manmanmano-2] => (item=dashboards)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/datasources",
-    "state": "absent"
+    "state": "directory"
 }

changed: [manmanmano-2] => (item=datasources)
 _____________________________________
< TASK [grafana : Grafana dashboards] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/grafana/files/dashboard.yaml
@@ -0,0 +1,24 @@
+apiVersion: 1
+
+providers:
+  # <string> an unique provider name. Required
+  - name: 'manmanmano'
+    # <int> Org id. Default to 1
+    orgId: 1
+    # <string> name of the dashboard folder.
+    folder: ''
+    # <string> folder UID. will be automatically generated if not specified
+    folderUid: ''
+    # <string> provider type. Default to 'file'
+    type: file
+    # <bool> disable dashboard deletion
+    disableDeletion: false
+    # <int> how often Grafana will scan for changed dashboards
+    updateIntervalSeconds: 10
+    # <bool> allow updating provisioned dashboards from the UI
+    allowUiUpdates: false
+    options:
+      # <string, required> path to dashboard files on disk. Required when using the 'file' type
+      path: /etc/grafana/provisioning/dashboards
+      # <bool> use folder names from filesystem to create folders in Grafana
+      foldersFromFilesStructure: true

changed: [manmanmano-2] => (item={'src': 'dashboard.yaml', 'dest': 'dashboards'})
--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/grafana/files/datasource.yaml
@@ -0,0 +1,76 @@
+# config file version
+apiVersion: 1
+
+# list of datasources that should be deleted from the database
+deleteDatasources:
+  - name: Graphite
+    orgId: 1
+
+# list of datasources to insert/update depending
+# what's available in the database
+datasources:
+  # <string, required> name of the datasource. Required
+  - name: Prometheus
+    # <string, required> datasource type. Required
+    type: prometheus
+    # <string, required> access mode. proxy or direct (Server or Browser in the UI). Required
+    access: proxy
+    # <int> org id. will default to orgId 1 if not specified
+    orgId: 1
+    # <string> url
+    url: http://prometheus:9090/prometheus/
+    # <string> Deprecated, use secureJsonData.password
+    password:
+    # <string> database user, if used
+    user:
+    # <string> database name, if used
+    database:
+    # <bool> mark as default datasource. Max one per org
+    isDefault: true
+    # <map> fields that will be converted to json and stored in jsonData
+    editable: false
+
+  - name: InfluxDB-latency
+    # <string, required> datasource type. Required
+    type: influxdb
+    # <string, required> access mode. proxy or direct (Server or Browser in the UI). Required
+    access: proxy
+    # <int> org id. will default to orgId 1 if not specified
+    orgId: 1
+    # <string> url
+    url: http://influxdb:8086
+    # <string> Deprecated, use secureJsonData.password
+    password:
+    # <string> database user, if used
+    user:
+    # <string> database name, if used
+    database: latency
+    # <bool> mark as default datasource. Max one per org
+    isDefault: false
+    # <map> fields that will be converted to json and stored in jsonData
+    editable: false
+    jsonData:
+      httpMode: GET
+
+  - name: InfluxDB-telegraf
+    # <string, required> datasource type. Required
+    type: influxdb
+    # <string, required> access mode. proxy or direct (Server or Browser in the UI). Required
+    access: proxy
+    # <int> org id. will default to orgId 1 if not specified
+    orgId: 1
+    # <string> custom UID which can be used to reference this datasource in other parts of the configuration, if not specified will be generated au>
+    # <string> url
+    url: http://influxdb:8086
+    # <string> Deprecated, use secureJsonData.password
+    password:
+    # <string> database user, if used
+    user:
+    # <string> database name, if used
+    database: telegraf
+    # <bool> mark as default datasource. Max one per org
+    isDefault: false
+    # <map> fields that will be converted to json and stored in jsonData
+    editable: false
+    jsonData:
+      httpMode: GET

changed: [manmanmano-2] => (item={'src': 'datasource.yaml', 'dest': 'datasources'})
 _____________________________________
< TASK [grafana : Grafana dashboards] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/grafana/files/main.json
@@ -0,0 +1,1391 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": "-- Grafana --",
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "target": {
+          "limit": 100,
+          "matchAny": false,
+          "tags": [],
+          "type": "dashboard"
+        },
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "gnetId": null,
+  "graphTooltip": 0,
+  "links": [],
+  "panels": [
+    {
+      "collapsed": false,
+      "datasource": null,
+      "gridPos": {
+        "h": 1,
+        "w": 24,
+        "x": 0,
+        "y": 0
+      },
+      "id": 40,
+      "panels": [],
+      "title": "HAProxy + Keepalived",
+      "type": "row"
+    },
+    {
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 2,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            },
+            {
+              "options": {
+                "match": "null",
+                "result": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                }
+              },
+              "type": "special"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 16,
+        "w": 24,
+        "x": 0,
+        "y": 1
+      },
+      "id": 36,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "last"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "text": {
+          "titleSize": 12
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "8.1.8",
+      "targets": [
+        {
+          "exemplar": true,
+          "expr": "haproxy_server_up",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "title": "HAProxy backend status",
+      "type": "stat"
+    },
+    {
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 0,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 1,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 17
+      },
+      "id": 34,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "last"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "text": {},
+        "textMode": "auto"
+      },
+      "pluginVersion": "8.1.8",
+      "targets": [
+        {
+          "exemplar": true,
+          "expr": "haproxy_up",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "title": "HAProxy frontend status",
+      "type": "stat"
+    },
+    {
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "1": {
+                  "color": "purple",
+                  "index": 1,
+                  "text": "BACKUP"
+                },
+                "2": {
+                  "color": "yellow",
+                  "index": 2,
+                  "text": "MASTER"
+                }
+              },
+              "type": "value"
+            },
+            {
+              "options": {
+                "match": "null",
+                "result": {
+                  "color": "red",
+                  "index": 0,
+                  "text": "DOWN"
+                }
+              },
+              "type": "special"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 17
+      },
+      "id": 38,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "last"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "text": {
+          "titleSize": 15
+        },
+        "textMode": "value_and_name"
+      },
+      "pluginVersion": "8.1.8",
+      "targets": [
+        {
+          "exemplar": true,
+          "expr": "keepalived_vrrp_state",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "title": "Keepalived master/backup",
+      "type": "stat"
+    },
+    {
+      "collapsed": false,
+      "datasource": null,
+      "gridPos": {
+        "h": 1,
+        "w": 24,
+        "x": 0,
+        "y": 25
+      },
+      "id": 28,
+      "panels": [],
+      "title": "InfluxDB",
+      "type": "row"
+    },
+    {
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "links": [],
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 26
+      },
+      "id": 30,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "last"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "text": {},
+        "textMode": "auto"
+      },
+      "pluginVersion": "8.1.8",
+      "targets": [
+        {
+          "exemplar": true,
+          "expr": "influxdb_exporter_stats_query_success",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "timeFrom": null,
+      "timeShift": null,
+      "title": "Status",
+      "type": "stat"
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "links": []
+        },
+        "overrides": []
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 26
+      },
+      "hiddenSeries": false,
+      "id": 32,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "8.1.8",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "expr": "rate(influxdb_write_write_ok[1m])",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "thresholds": [],
+      "timeFrom": null,
+      "timeRegions": [],
+      "timeShift": null,
+      "title": "Write rate",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "buckets": null,
+        "mode": "time",
+        "name": null,
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        },
+        {
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false,
+        "alignLevel": null
+      }
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": "InfluxDB-latency",
+      "fill": 0,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 8,
+        "w": 24,
+        "x": 0,
+        "y": 34
+      },
+      "hiddenSeries": false,
+      "id": 26,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": false,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "8.1.8",
+      "pointradius": 0.5,
+      "points": true,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "groupBy": [
+            {
+              "params": [
+                "$__interval"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "dst"
+              ],
+              "type": "tag"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "latency",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "A",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "rtt"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "mean"
+              }
+            ]
+          ],
+          "tags": []
+        }
+      ],
+      "thresholds": [],
+      "timeFrom": null,
+      "timeRegions": [],
+      "timeShift": null,
+      "title": "Pinger",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "buckets": null,
+        "mode": "time",
+        "name": null,
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "$$hashKey": "object:242",
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        },
+        {
+          "$$hashKey": "object:243",
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false,
+        "alignLevel": null
+      }
+    },
+    {
+      "collapsed": false,
+      "datasource": null,
+      "gridPos": {
+        "h": 1,
+        "w": 24,
+        "x": 0,
+        "y": 42
+      },
+      "id": 24,
+      "panels": [],
+      "title": "NGINX",
+      "type": "row"
+    },
+    {
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "text": "DOWN"
+                },
+                "1": {
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 43
+      },
+      "id": 20,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "last"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "text": {},
+        "textMode": "auto"
+      },
+      "pluginVersion": "8.1.8",
+      "targets": [
+        {
+          "expr": "nginx_up",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "timeFrom": null,
+      "timeShift": null,
+      "title": "NGINX status",
+      "type": "stat"
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "links": []
+        },
+        "overrides": []
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 43
+      },
+      "hiddenSeries": false,
+      "id": 22,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "8.1.8",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "expr": "rate(nginx_http_requests_total[1m])",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "thresholds": [],
+      "timeFrom": null,
+      "timeRegions": [],
+      "timeShift": null,
+      "title": "Requests per minute",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "buckets": null,
+        "mode": "time",
+        "name": null,
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        },
+        {
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false,
+        "alignLevel": null
+      }
+    },
+    {
+      "collapsed": false,
+      "datasource": null,
+      "gridPos": {
+        "h": 1,
+        "w": 24,
+        "x": 0,
+        "y": 51
+      },
+      "id": 18,
+      "panels": [],
+      "title": "MySQL",
+      "type": "row"
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "links": []
+        },
+        "overrides": []
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 10,
+        "w": 24,
+        "x": 0,
+        "y": 52
+      },
+      "hiddenSeries": false,
+      "id": 16,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "rightSide": true,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "8.1.8",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "expr": "rate(mysql_global_status_commands_total[1m])",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "thresholds": [],
+      "timeFrom": null,
+      "timeRegions": [],
+      "timeShift": null,
+      "title": "SELECTs per minute",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "buckets": null,
+        "mode": "time",
+        "name": null,
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "$$hashKey": "object:326",
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        },
+        {
+          "$$hashKey": "object:327",
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false,
+        "alignLevel": null
+      }
+    },
+    {
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "from": 0.5,
+                "result": {
+                  "text": "UP"
+                },
+                "to": 1
+              },
+              "type": "range"
+            },
+            {
+              "options": {
+                "from": 0,
+                "result": {
+                  "text": "DOWN"
+                },
+                "to": 0.4
+              },
+              "type": "range"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 9,
+        "w": 24,
+        "x": 0,
+        "y": 62
+      },
+      "id": 14,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "horizontal",
+        "reduceOptions": {
+          "calcs": [
+            "last"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "text": {
+          "valueSize": 90
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "8.1.8",
+      "targets": [
+        {
+          "expr": "mysql_up",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "timeFrom": null,
+      "timeShift": null,
+      "title": "MySQL status",
+      "type": "stat"
+    },
+    {
+      "collapsed": false,
+      "datasource": null,
+      "gridPos": {
+        "h": 1,
+        "w": 24,
+        "x": 0,
+        "y": 71
+      },
+      "id": 12,
+      "panels": [],
+      "title": "Bind9",
+      "type": "row"
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "links": []
+        },
+        "overrides": []
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 9,
+        "w": 24,
+        "x": 0,
+        "y": 72
+      },
+      "hiddenSeries": false,
+      "id": 10,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "rightSide": true,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "8.1.8",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "expr": "rate(bind_resolver_queries_total[1m])",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "thresholds": [],
+      "timeFrom": null,
+      "timeRegions": [],
+      "timeShift": null,
+      "title": "DNS queries per minute",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "buckets": null,
+        "mode": "time",
+        "name": null,
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "$$hashKey": "object:162",
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        },
+        {
+          "$$hashKey": "object:163",
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false,
+        "alignLevel": null
+      }
+    },
+    {
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "text": "DOWN"
+                },
+                "1": {
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 9,
+        "w": 24,
+        "x": 0,
+        "y": 81
+      },
+      "id": 8,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "horizontal",
+        "reduceOptions": {
+          "calcs": [
+            "last"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "text": {
+          "valueSize": 90
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "8.1.8",
+      "targets": [
+        {
+          "expr": "bind_up",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "timeFrom": null,
+      "timeShift": null,
+      "title": "Bind9 status",
+      "type": "stat"
+    },
+    {
+      "collapsed": false,
+      "datasource": null,
+      "gridPos": {
+        "h": 1,
+        "w": 24,
+        "x": 0,
+        "y": 90
+      },
+      "id": 6,
+      "panels": [],
+      "title": "CPU and RAM",
+      "type": "row"
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "links": []
+        },
+        "overrides": []
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 8,
+        "w": 24,
+        "x": 0,
+        "y": 91
+      },
+      "hiddenSeries": false,
+      "id": 2,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "rightSide": true,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "8.1.8",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "expr": "rate(node_cpu_seconds_total[1m])",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "thresholds": [],
+      "timeFrom": null,
+      "timeRegions": [],
+      "timeShift": null,
+      "title": "CPU load",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "buckets": null,
+        "mode": "time",
+        "name": null,
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "$$hashKey": "object:81",
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        },
+        {
+          "$$hashKey": "object:82",
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false,
+        "alignLevel": null
+      }
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "links": []
+        },
+        "overrides": []
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 8,
+        "w": 24,
+        "x": 0,
+        "y": 99
+      },
+      "hiddenSeries": false,
+      "id": 4,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "8.1.8",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "expr": "rate(node_memory_Active_bytes[1m])",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "thresholds": [],
+      "timeFrom": null,
+      "timeRegions": [],
+      "timeShift": null,
+      "title": "RAM load",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "buckets": null,
+        "mode": "time",
+        "name": null,
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        },
+        {
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false,
+        "alignLevel": null
+      }
+    }
+  ],
+  "refresh": "10s",
+  "schemaVersion": 30,
+  "style": "dark",
+  "tags": [],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-5m",
+    "to": "now"
+  },
+  "timepicker": {
+    "refresh_intervals": [
+      "10s",
+      "30s",
+      "1m",
+      "5m",
+      "15m",
+      "30m",
+      "1h",
+      "2h",
+      "1d"
+    ]
+  },
+  "timezone": "",
+  "title": "clounsible.mano",
+  "uid": "mPEUZid7k",
+  "version": 1
+}

changed: [manmanmano-2] => (item={'src': 'main.json', 'dest': 'main.json'})
--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/grafana/files/mysql.json
@@ -0,0 +1,591 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": "-- Grafana --",
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "target": {
+          "limit": 100,
+          "matchAny": false,
+          "tags": [],
+          "type": "dashboard"
+        },
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "gnetId": null,
+  "graphTooltip": 0,
+  "links": [],
+  "panels": [
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "links": []
+        },
+        "overrides": []
+      },
+      "fill": 1,
+      "fillGradient": 10,
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 0
+      },
+      "hiddenSeries": false,
+      "id": 12,
+      "legend": {
+        "avg": false,
+        "current": false,
+        "hideEmpty": false,
+        "max": false,
+        "min": false,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 2,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "8.1.8",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "expr": "mysql_slave_status_slave_io_running",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "thresholds": [],
+      "timeFrom": null,
+      "timeRegions": [],
+      "timeShift": null,
+      "title": "IO replication thread status",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "buckets": null,
+        "mode": "time",
+        "name": null,
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "$$hashKey": "object:265",
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        },
+        {
+          "$$hashKey": "object:266",
+          "format": "short",
+          "label": "",
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false,
+        "alignLevel": null
+      }
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "links": []
+        },
+        "overrides": []
+      },
+      "fill": 1,
+      "fillGradient": 10,
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 0
+      },
+      "hiddenSeries": false,
+      "id": 13,
+      "legend": {
+        "alignAsTable": false,
+        "avg": false,
+        "current": false,
+        "hideEmpty": false,
+        "max": false,
+        "min": false,
+        "rightSide": false,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 2,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "8.1.8",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "exemplar": true,
+          "expr": "mysql_slave_status_slave_sql_running",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "thresholds": [],
+      "timeFrom": null,
+      "timeRegions": [],
+      "timeShift": null,
+      "title": "SQL replication thread status",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "buckets": null,
+        "mode": "time",
+        "name": null,
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "$$hashKey": "object:265",
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        },
+        {
+          "$$hashKey": "object:266",
+          "format": "short",
+          "label": "",
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false,
+        "alignLevel": null
+      }
+    },
+    {
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "match": "null",
+                "result": {
+                  "color": "red",
+                  "index": 0,
+                  "text": "DOWN"
+                }
+              },
+              "type": "special"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "blue",
+                "value": null
+              },
+              {
+                "color": "orange",
+                "value": 120
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 8
+      },
+      "id": 8,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "last"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "text": {
+          "titleSize": 15
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "8.1.8",
+      "targets": [
+        {
+          "expr": "mysql_global_variables_server_id",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "timeFrom": null,
+      "timeShift": null,
+      "title": "Server ID",
+      "type": "stat"
+    },
+    {
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 0,
+                  "text": "READ/WRITE"
+                },
+                "1": {
+                  "index": 1,
+                  "text": "READ_ONLY"
+                }
+              },
+              "type": "value"
+            },
+            {
+              "options": {
+                "match": "null",
+                "result": {
+                  "color": "red",
+                  "index": 2,
+                  "text": "DOWN"
+                }
+              },
+              "type": "special"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "purple",
+                "value": null
+              },
+              {
+                "color": "yellow",
+                "value": 1
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 8
+      },
+      "id": 6,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "last"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "text": {
+          "titleSize": 15
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "8.1.8",
+      "targets": [
+        {
+          "expr": "mysql_global_variables_read_only",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "timeFrom": null,
+      "timeShift": null,
+      "title": "Read only status",
+      "type": "stat"
+    },
+    {
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "from": 0.5,
+                "result": {
+                  "text": "UP"
+                },
+                "to": 1
+              },
+              "type": "range"
+            },
+            {
+              "options": {
+                "from": 0,
+                "result": {
+                  "text": "DOWN"
+                },
+                "to": 0.4
+              },
+              "type": "range"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 9,
+        "w": 24,
+        "x": 0,
+        "y": 16
+      },
+      "id": 2,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "horizontal",
+        "reduceOptions": {
+          "calcs": [
+            "last"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "text": {
+          "valueSize": 95
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "8.1.8",
+      "targets": [
+        {
+          "expr": "mysql_up",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "timeFrom": null,
+      "timeShift": null,
+      "title": "MySQL status",
+      "type": "stat"
+    },
+    {
+      "aliasColors": {},
+      "bars": false,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": null,
+      "fieldConfig": {
+        "defaults": {
+          "links": []
+        },
+        "overrides": []
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 9,
+        "w": 24,
+        "x": 0,
+        "y": 25
+      },
+      "hiddenSeries": false,
+      "id": 4,
+      "legend": {
+        "alignAsTable": false,
+        "avg": false,
+        "current": false,
+        "max": false,
+        "min": false,
+        "rightSide": true,
+        "show": true,
+        "total": false,
+        "values": false
+      },
+      "lines": true,
+      "linewidth": 1,
+      "nullPointMode": "null",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "8.1.8",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "expr": "rate(mysql_global_status_commands_total[1m])",
+          "interval": "",
+          "legendFormat": "",
+          "refId": "A"
+        }
+      ],
+      "thresholds": [],
+      "timeFrom": null,
+      "timeRegions": [],
+      "timeShift": null,
+      "title": "SELECTs per minute",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "buckets": null,
+        "mode": "time",
+        "name": null,
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "$$hashKey": "object:65",
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        },
+        {
+          "$$hashKey": "object:66",
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        }
+      ],
+      "yaxis": {
+        "align": false,
+        "alignLevel": null
+      }
+    }
+  ],
+  "refresh": "10s",
+  "schemaVersion": 30,
+  "style": "dark",
+  "tags": [],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-5m",
+    "to": "now"
+  },
+  "timepicker": {
+    "refresh_intervals": [
+      "10s",
+      "30s",
+      "1m",
+      "5m",
+      "15m",
+      "30m",
+      "1h",
+      "2h",
+      "1d"
+    ]
+  },
+  "timezone": "",
+  "title": "MySQL",
+  "uid": "-gAQY4tnk",
+  "version": 1
+}

changed: [manmanmano-2] => (item={'src': 'mysql.json', 'dest': 'mysql.json'})
--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/grafana/files/syslog.json
@@ -0,0 +1,1028 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": "-- Grafana --",
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "type": "dashboard"
+      }
+    ]
+  },
+  "description": "Telegraf / InfluxDB / Grafana as syslog receiver",
+  "editable": true,
+  "gnetId": 12433,
+  "graphTooltip": 0,
+  "id": 2,
+  "iteration": 1635417325840,
+  "links": [],
+  "panels": [
+    {
+      "aliasColors": {},
+      "bars": true,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": "InfluxDB-telegraf",
+      "decimals": 0,
+      "fieldConfig": {
+        "defaults": {
+          "custom": {}
+        },
+        "overrides": []
+      },
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 7,
+        "w": 24,
+        "x": 0,
+        "y": 0
+      },
+      "hiddenSeries": false,
+      "id": 10,
+      "interval": "",
+      "legend": {
+        "alignAsTable": true,
+        "avg": true,
+        "current": false,
+        "max": true,
+        "min": false,
+        "rightSide": true,
+        "show": true,
+        "sort": null,
+        "sortDesc": null,
+        "total": true,
+        "values": true
+      },
+      "lines": false,
+      "linewidth": 1,
+      "links": [],
+      "nullPointMode": "connected",
+      "options": {
+        "alertThreshold": true,
+        "dataLinks": []
+      },
+      "percentage": false,
+      "pluginVersion": "7.4.0",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [
+        {
+          "alias": "Info",
+          "color": "rgb(80, 80, 80)",
+          "stack": "A"
+        },
+        {
+          "alias": "Notice",
+          "color": "rgb(182, 182, 182)",
+          "stack": "A"
+        },
+        {
+          "alias": "Warning",
+          "color": "#E0B400",
+          "stack": "A"
+        },
+        {
+          "alias": "Error",
+          "color": "#FF780A",
+          "stack": "A"
+        },
+        {
+          "alias": "Critical",
+          "color": "#E02F44",
+          "stack": "A"
+        },
+        {
+          "alias": "Alert",
+          "color": "#8F3BB8",
+          "stack": "A"
+        },
+        {
+          "alias": "Emergency",
+          "color": "#8F3BB8",
+          "stack": "A"
+        }
+      ],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "alias": "Info",
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "A",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "info"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Notice",
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "B",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "notice"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Warning",
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "D",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "warning"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Error",
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "C",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "err"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Critical",
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "E",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "crit"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Alert",
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "F",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "alert"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Emergency",
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "G",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "emerg"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        }
+      ],
+      "thresholds": [],
+      "timeFrom": null,
+      "timeRegions": [],
+      "timeShift": null,
+      "title": "syslog count",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "buckets": null,
+        "mode": "time",
+        "name": null,
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "decimals": 0,
+          "format": "none",
+          "label": "Messages / min",
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": true
+        },
+        {
+          "format": "short",
+          "label": null,
+          "logBase": 1,
+          "max": null,
+          "min": null,
+          "show": false
+        }
+      ],
+      "yaxis": {
+        "align": false,
+        "alignLevel": null
+      }
+    },
+    {
+      "datasource": "InfluxDB-telegraf",
+      "description": "",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "custom": {
+            "align": "left",
+            "displayMode": "auto",
+            "filterable": false
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "dark-purple",
+                "value": null
+              },
+              {
+                "color": "dark-red",
+                "value": 2
+              },
+              {
+                "color": "dark-orange",
+                "value": 3
+              },
+              {
+                "color": "dark-yellow",
+                "value": 4
+              },
+              {
+                "color": "rgb(150, 150, 150)",
+                "value": 5
+              },
+              {
+                "color": "rgb(51, 51, 51)",
+                "value": 6
+              },
+              {
+                "color": "rgb(5, 5, 5)",
+                "value": 7
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "severity_code"
+            },
+            "properties": [
+              {
+                "id": "mappings",
+                "value": [
+                  {
+                    "from": "",
+                    "id": 0,
+                    "text": "Debug",
+                    "to": "",
+                    "type": 1,
+                    "value": "7"
+                  },
+                  {
+                    "from": "",
+                    "id": 1,
+                    "text": "Info",
+                    "to": "",
+                    "type": 1,
+                    "value": "6"
+                  },
+                  {
+                    "from": "",
+                    "id": 2,
+                    "text": "Notice",
+                    "to": "",
+                    "type": 1,
+                    "value": "5"
+                  },
+                  {
+                    "from": "",
+                    "id": 3,
+                    "text": "Warning",
+                    "to": "",
+                    "type": 1,
+                    "value": "4"
+                  },
+                  {
+                    "from": "",
+                    "id": 4,
+                    "text": "Error",
+                    "to": "",
+                    "type": 1,
+                    "value": "3"
+                  },
+                  {
+                    "from": "",
+                    "id": 5,
+                    "text": "Critical",
+                    "to": "",
+                    "type": 1,
+                    "value": "2"
+                  },
+                  {
+                    "from": "",
+                    "id": 6,
+                    "text": "Alert",
+                    "to": "",
+                    "type": 1,
+                    "value": "1"
+                  },
+                  {
+                    "from": "",
+                    "id": 7,
+                    "text": "Emergency",
+                    "to": "",
+                    "type": 1,
+                    "value": "0"
+                  }
+                ]
+              },
+              {
+                "id": "custom.displayMode",
+                "value": "color-background"
+              },
+              {
+                "id": "custom.width",
+                "value": 119
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "Time"
+            },
+            "properties": [
+              {
+                "id": "custom.width",
+                "value": 163
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "hostname"
+            },
+            "properties": [
+              {
+                "id": "custom.width",
+                "value": 194
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "appname"
+            },
+            "properties": [
+              {
+                "id": "custom.width",
+                "value": 264
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 24,
+        "w": 24,
+        "x": 0,
+        "y": 7
+      },
+      "id": 12,
+      "options": {
+        "showHeader": true,
+        "sortBy": [
+          {
+            "desc": true,
+            "displayName": "Time"
+          }
+        ]
+      },
+      "pluginVersion": "7.0.0",
+      "targets": [
+        {
+          "groupBy": [
+            {
+              "params": [
+                "hostname"
+              ],
+              "type": "tag"
+            },
+            {
+              "params": [
+                "appname"
+              ],
+              "type": "tag"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "A",
+          "resultFormat": "table",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              }
+            ],
+            [
+              {
+                "params": [
+                  "message"
+                ],
+                "type": "field"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        }
+      ],
+      "timeFrom": null,
+      "timeShift": null,
+      "title": "Syslog Messages",
+      "type": "table"
+    }
+  ],
+  "refresh": "5s",
+  "schemaVersion": 25,
+  "style": "dark",
+  "tags": [],
+  "templating": {
+    "list": [
+      {
+        "allValue": "",
+        "current": {
+          "selected": false,
+          "text": "All",
+          "value": "$__all"
+        },
+        "datasource": "InfluxDB-telegraf",
+        "definition": "SHOW TAG VALUES FROM syslog WITH KEY=appname",
+        "description": null,
+        "error": null,
+        "hide": 0,
+        "includeAll": true,
+        "label": "Appname",
+        "multi": true,
+        "name": "appname",
+        "options": [],
+        "query": "SHOW TAG VALUES FROM syslog WITH KEY=appname",
+        "refresh": 2,
+        "regex": "",
+        "skipUrlSync": false,
+        "sort": 1,
+        "tagValuesQuery": "",
+        "tags": [],
+        "tagsQuery": "",
+        "type": "query",
+        "useTags": false
+      },
+      {
+        "allValue": "",
+        "current": {
+          "selected": false,
+          "text": "All",
+          "value": "$__all"
+        },
+        "datasource": "InfluxDB-telegraf",
+        "definition": "SHOW TAG VALUES FROM syslog WITH KEY=hostname",
+        "description": null,
+        "error": null,
+        "hide": 0,
+        "includeAll": true,
+        "label": "Hostname",
+        "multi": true,
+        "name": "hostname",
+        "options": [],
+        "query": "SHOW TAG VALUES FROM syslog WITH KEY=hostname",
+        "refresh": 2,
+        "regex": "",
+        "skipUrlSync": false,
+        "sort": 1,
+        "tagValuesQuery": "",
+        "tags": [],
+        "tagsQuery": "",
+        "type": "query",
+        "useTags": false
+      },
+      {
+        "allValue": "",
+        "current": {
+          "selected": false,
+          "text": "All",
+          "value": "$__all"
+        },
+        "datasource": "InfluxDB-telegraf",
+        "definition": "SHOW TAG VALUES FROM syslog WITH KEY=severity",
+        "description": null,
+        "error": null,
+        "hide": 0,
+        "includeAll": true,
+        "label": "Severity",
+        "multi": true,
+        "name": "severity",
+        "options": [],
+        "query": "SHOW TAG VALUES FROM syslog WITH KEY=severity",
+        "refresh": 2,
+        "regex": "",
+        "skipUrlSync": false,
+        "sort": 0,
+        "tagValuesQuery": "",
+        "tags": [],
+        "tagsQuery": "",
+        "type": "query",
+        "useTags": false
+      },
+      {
+        "current": {
+          "selected": false,
+          "text": "",
+          "value": ""
+        },
+        "description": "Querystring",
+        "error": null,
+        "hide": 0,
+        "label": "MessageQuery",
+        "name": "Query",
+        "options": [
+          {
+            "selected": true,
+            "text": "",
+            "value": ""
+          }
+        ],
+        "query": "",
+        "skipUrlSync": false,
+        "type": "textbox"
+      }
+    ]
+  },
+  "time": {
+    "from": "now-1h",
+    "to": "now"
+  },
+  "timepicker": {
+    "refresh_intervals": [
+      " 10s",
+      " 30s",
+      " 1m",
+      " 5m"
+    ],
+    "time_options": [
+      "5m",
+      "15m",
+      "1h",
+      "6h",
+      "12h",
+      "24h",
+      "2d",
+      "7d",
+      "30d"
+    ]
+  },
+  "timezone": "",
+  "title": "Syslog",
+  "uid": "TIYeHqRgZ",
+  "version": 2
+}

changed: [manmanmano-2] => (item={'src': 'syslog.json', 'dest': 'syslog.json'})
 ___________________________________________
< TASK [grafana : Grafana docker container] >
 -------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [manmanmano-2]
 _________________
< PLAY [InfluxDB] >
 -----------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ____________________________
< TASK [influxdb : Repo key] >
 ----------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
 _____________________________________
< TASK [influxdb : Add influxdb repo] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before: /dev/null
+++ after: /etc/apt/sources.list.d/repos_influxdata_com_ubuntu.list
@@ -0,0 +1 @@
+deb https://repos.influxdata.com/ubuntu focal stable

changed: [manmanmano-2]
 ____________________________________
< TASK [influxdb : Install influxdb] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


The following NEW packages will be installed:
  influxdb
0 upgraded, 1 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-2]
 ______________________________________
< TASK [influxdb : Copy influxdb.conf] >
 --------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before: /etc/influxdb/influxdb.conf
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/influxdb/files/influxdb.conf
@@ -1,596 +1,22 @@
-### Welcome to the InfluxDB configuration file.
-
-# The values in this file override the default values used by the system if
-# a config option is not specified. The commented out lines are the configuration
-# field and the default value used. Uncommenting a line and changing the value
-# will change the value used at runtime when the process is restarted.
-
-# Once every 24 hours InfluxDB will report usage data to usage.influxdata.com
-# The data includes a random ID, os, arch, version, the number of series and other
-# usage data. No data from user databases is ever transmitted.
-# Change this option to true to disable reporting.
-# reporting-disabled = false
-
-# Bind address to use for the RPC service for backup and restore.
-# bind-address = "127.0.0.1:8088"
-
-###
-### [meta]
-###
-### Controls the parameters for the Raft consensus group that stores metadata
-### about the InfluxDB cluster.
-###
-
 [meta]
-  # Where the metadata/raft database is stored
   dir = "/var/lib/influxdb/meta"
-
-  # Automatically create a default retention policy when creating a database.
-  # retention-autocreate = true
-
-  # If log messages are printed for the meta service
-  # logging-enabled = true
-
-###
-### [data]
-###
-### Controls where the actual shard data for InfluxDB lives and how it is
-### flushed from the WAL. "dir" may need to be changed to a suitable place
-### for your system, but the WAL settings are an advanced configuration. The
-### defaults should work for most systems.
-###
-
 [data]
-  # The directory where the TSM storage engine stores TSM files.
   dir = "/var/lib/influxdb/data"
-
-  # The directory where the TSM storage engine stores WAL files.
   wal-dir = "/var/lib/influxdb/wal"
-
-  # The amount of time that a write will wait before fsyncing.  A duration
-  # greater than 0 can be used to batch up multiple fsync calls.  This is useful for slower
-  # disks or when WAL write contention is seen.  A value of 0s fsyncs every write to the WAL.
-  # Values in the range of 0-100ms are recommended for non-SSD disks.
-  # wal-fsync-delay = "0s"
-
-
-  # The type of shard index to use for new shards.  The default is an in-memory index that is
-  # recreated at startup.  A value of "tsi1" will use a disk based index that supports higher
-  # cardinality datasets.
-  # index-version = "inmem"
-
-  # Trace logging provides more verbose output around the tsm engine. Turning
-  # this on can provide more useful output for debugging tsm engine issues.
-  # trace-logging-enabled = false
-
-  # Whether queries should be logged before execution. Very useful for troubleshooting, but will
-  # log any sensitive data contained within a query.
-  # query-log-enabled = true
-
-  # Provides more error checking. For example, SELECT INTO will err out inserting an +/-Inf value
-  # rather than silently failing.
-  # strict-error-handling = false
-
-  # Validates incoming writes to ensure keys only have valid unicode characters.
-  # This setting will incur a small overhead because every key must be checked.
-  # validate-keys = false
-
-  # Settings for the TSM engine
-
-  # CacheMaxMemorySize is the maximum size a shard's cache can
-  # reach before it starts rejecting writes.
-  # Valid size suffixes are k, m, or g (case insensitive, 1024 = 1k).
-  # Values without a size suffix are in bytes.
-  # cache-max-memory-size = "1g"
-
-  # CacheSnapshotMemorySize is the size at which the engine will
-  # snapshot the cache and write it to a TSM file, freeing up memory
-  # Valid size suffixes are k, m, or g (case insensitive, 1024 = 1k).
-  # Values without a size suffix are in bytes.
-  # cache-snapshot-memory-size = "25m"
-
-  # CacheSnapshotWriteColdDuration is the length of time at
-  # which the engine will snapshot the cache and write it to
-  # a new TSM file if the shard hasn't received writes or deletes
-  # cache-snapshot-write-cold-duration = "10m"
-
-  # CompactFullWriteColdDuration is the duration at which the engine
-  # will compact all TSM files in a shard if it hasn't received a
-  # write or delete
-  # compact-full-write-cold-duration = "4h"
-
-  # The maximum number of concurrent full and level compactions that can run at one time.  A
-  # value of 0 results in 50% of runtime.GOMAXPROCS(0) used at runtime.  Any number greater
-  # than 0 limits compactions to that value.  This setting does not apply
-  # to cache snapshotting.
-  # max-concurrent-compactions = 0
-
-  # CompactThroughput is the rate limit in bytes per second that we
-  # will allow TSM compactions to write to disk. Note that short bursts are allowed
-  # to happen at a possibly larger value, set by CompactThroughputBurst
-  # compact-throughput = "48m"
-
-  # CompactThroughputBurst is the rate limit in bytes per second that we
-  # will allow TSM compactions to write to disk.
-  # compact-throughput-burst = "48m"
-
-  # If true, then the mmap advise value MADV_WILLNEED will be provided to the kernel with respect to
-  # TSM files. This setting has been found to be problematic on some kernels, and defaults to off.
-  # It might help users who have slow disks in some cases.
-  # tsm-use-madv-willneed = false
-
-  # Settings for the inmem index
-
-  # The maximum series allowed per database before writes are dropped.  This limit can prevent
-  # high cardinality issues at the database level.  This limit can be disabled by setting it to
-  # 0.
-  # max-series-per-database = 1000000
-
-  # The maximum number of tag values per tag that are allowed before writes are dropped.  This limit
-  # can prevent high cardinality tag values from being written to a measurement.  This limit can be
-  # disabled by setting it to 0.
-  # max-values-per-tag = 100000
-
-  # Settings for the tsi1 index
-
-  # The threshold, in bytes, when an index write-ahead log file will compact
-  # into an index file. Lower sizes will cause log files to be compacted more
-  # quickly and result in lower heap usage at the expense of write throughput.
-  # Higher sizes will be compacted less frequently, store more series in-memory,
-  # and provide higher write throughput.
-  # Valid size suffixes are k, m, or g (case insensitive, 1024 = 1k).
-  # Values without a size suffix are in bytes.
-  # max-index-log-file-size = "1m"
-
-  # The size of the internal cache used in the TSI index to store previously 
-  # calculated series results. Cached results will be returned quickly from the cache rather
-  # than needing to be recalculated when a subsequent query with a matching tag key/value 
-  # predicate is executed. Setting this value to 0 will disable the cache, which may
-  # lead to query performance issues.
-  # This value should only be increased if it is known that the set of regularly used 
-  # tag key/value predicates across all measurements for a database is larger than 100. An
-  # increase in cache size may lead to an increase in heap usage.
   series-id-set-cache-size = 100
-
-###
-### [coordinator]
-###
-### Controls the clustering service configuration.
-###
-
+  query-log-enabled = false
 [coordinator]
-  # The default time a write request will wait until a "timeout" error is returned to the caller.
-  # write-timeout = "10s"
-
-  # The maximum number of concurrent queries allowed to be executing at one time.  If a query is
-  # executed and exceeds this limit, an error is returned to the caller.  This limit can be disabled
-  # by setting it to 0.
-  # max-concurrent-queries = 0
-
-  # The maximum time a query will is allowed to execute before being killed by the system.  This limit
-  # can help prevent run away queries.  Setting the value to 0 disables the limit.
-  # query-timeout = "0s"
-
-  # The time threshold when a query will be logged as a slow query.  This limit can be set to help
-  # discover slow or resource intensive queries.  Setting the value to 0 disables the slow query logging.
-  # log-queries-after = "0s"
-
-  # The maximum number of points a SELECT can process.  A value of 0 will make
-  # the maximum point count unlimited.  This will only be checked every second so queries will not
-  # be aborted immediately when hitting the limit.
-  # max-select-point = 0
-
-  # The maximum number of series a SELECT can run.  A value of 0 will make the maximum series
-  # count unlimited.
-  # max-select-series = 0
-
-  # The maximum number of group by time bucket a SELECT can create.  A value of zero will max the maximum
-  # number of buckets unlimited.
-  # max-select-buckets = 0
-
-###
-### [retention]
-###
-### Controls the enforcement of retention policies for evicting old data.
-###
-
 [retention]
-  # Determines whether retention policy enforcement enabled.
-  # enabled = true
-
-  # The interval of time when retention policy enforcement checks run.
-  # check-interval = "30m"
-
-###
-### [shard-precreation]
-###
-### Controls the precreation of shards, so they are available before data arrives.
-### Only shards that, after creation, will have both a start- and end-time in the
-### future, will ever be created. Shards are never precreated that would be wholly
-### or partially in the past.
-
 [shard-precreation]
-  # Determines whether shard pre-creation service is enabled.
-  # enabled = true
-
-  # The interval of time when the check to pre-create new shards runs.
-  # check-interval = "10m"
-
-  # The default period ahead of the endtime of a shard group that its successor
-  # group is created.
-  # advance-period = "30m"
-
-###
-### Controls the system self-monitoring, statistics and diagnostics.
-###
-### The internal database for monitoring data is created automatically if
-### if it does not already exist. The target retention within this database
-### is called 'monitor' and is also created with a retention period of 7 days
-### and a replication factor of 1, if it does not exist. In all cases the
-### this retention policy is configured as the default for the database.
-
 [monitor]
-  # Whether to record statistics internally.
-  # store-enabled = true
-
-  # The destination database for recorded statistics
-  # store-database = "_internal"
-
-  # The interval at which to record statistics
-  # store-interval = "10s"
-
-###
-### [http]
-###
-### Controls how the HTTP endpoints are configured. These are the primary
-### mechanism for getting data into and out of InfluxDB.
-###
-
 [http]
-  # Determines whether HTTP endpoint is enabled.
-  # enabled = true
-
-  # Determines whether the Flux query endpoint is enabled.
-  # flux-enabled = false
-
-  # Determines whether the Flux query logging is enabled.
-  # flux-log-enabled = false
-
-  # The bind address used by the HTTP service.
-  # bind-address = ":8086"
-
-  # Determines whether user authentication is enabled over HTTP/HTTPS.
-  # auth-enabled = false
-
-  # The default realm sent back when issuing a basic auth challenge.
-  # realm = "InfluxDB"
-
-  # Determines whether HTTP request logging is enabled.
-  # log-enabled = true
-
-  # Determines whether the HTTP write request logs should be suppressed when the log is enabled.
-  # suppress-write-log = false
-
-  # When HTTP request logging is enabled, this option specifies the path where
-  # log entries should be written. If unspecified, the default is to write to stderr, which
-  # intermingles HTTP logs with internal InfluxDB logging.
-  #
-  # If influxd is unable to access the specified path, it will log an error and fall back to writing
-  # the request log to stderr.
-  # access-log-path = ""
-
-  # Filters which requests should be logged. Each filter is of the pattern NNN, NNX, or NXX where N is
-  # a number and X is a wildcard for any number. To filter all 5xx responses, use the string 5xx.
-  # If multiple filters are used, then only one has to match. The default is to have no filters which
-  # will cause every request to be printed.
-  # access-log-status-filters = []
-
-  # Determines whether detailed write logging is enabled.
-  # write-tracing = false
-
-  # Determines whether the pprof endpoint is enabled.  This endpoint is used for
-  # troubleshooting and monitoring.
-  # pprof-enabled = true
-
-  # Enables authentication on pprof endpoints. Users will need admin permissions
-  # to access the pprof endpoints when this setting is enabled. This setting has
-  # no effect if either auth-enabled or pprof-enabled are set to false.
-  # pprof-auth-enabled = false
-
-  # Enables a pprof endpoint that binds to localhost:6060 immediately on startup.
-  # This is only needed to debug startup issues.
-  # debug-pprof-enabled = false
-
-  # Enables authentication on the /ping, /metrics, and deprecated /status
-  # endpoints. This setting has no effect if auth-enabled is set to false.
-  # ping-auth-enabled = false
-
-  # Determines whether HTTPS is enabled.
-  # https-enabled = false
-
-  # The SSL certificate to use when HTTPS is enabled.
-  # https-certificate = "/etc/ssl/influxdb.pem"
-
-  # Use a separate private key location.
-  # https-private-key = ""
-
-  # The JWT auth shared secret to validate requests using JSON web tokens.
-  # shared-secret = ""
-
-  # The default chunk size for result sets that should be chunked.
-  # max-row-limit = 0
-
-  # The maximum number of HTTP connections that may be open at once.  New connections that
-  # would exceed this limit are dropped.  Setting this value to 0 disables the limit.
-  # max-connection-limit = 0
-
-  # Enable http service over unix domain socket
-  # unix-socket-enabled = false
-
-  # The path of the unix domain socket.
-  # bind-socket = "/var/run/influxdb.sock"
-
-  # The maximum size of a client request body, in bytes. Setting this value to 0 disables the limit.
-  # max-body-size = 25000000
-
-  # The maximum number of writes processed concurrently.
-  # Setting this to 0 disables the limit.
-  # max-concurrent-write-limit = 0
-
-  # The maximum number of writes queued for processing.
-  # Setting this to 0 disables the limit.
-  # max-enqueued-write-limit = 0
-
-  # The maximum duration for a write to wait in the queue to be processed.
-  # Setting this to 0 or setting max-concurrent-write-limit to 0 disables the limit.
-  # enqueued-write-timeout = 0
-
-	# User supplied HTTP response headers
-	#
-	# [http.headers]
-	#   X-Header-1 = "Header Value 1"
-	#   X-Header-2 = "Header Value 2"
-
-###
-### [logging]
-###
-### Controls how the logger emits logs to the output.
-###
-
+  log-enabled = false
+  write-tracing = false
 [logging]
-  # Determines which log encoder to use for logs. Available options
-  # are auto, logfmt, and json. auto will use a more a more user-friendly
-  # output format if the output terminal is a TTY, but the format is not as
-  # easily machine-readable. When the output is a non-TTY, auto will use
-  # logfmt.
-  # format = "auto"
-
-  # Determines which level of logs will be emitted. The available levels
-  # are error, warn, info, and debug. Logs that are equal to or above the
-  # specified level will be emitted.
-  # level = "info"
-
-  # Suppresses the logo output that is printed when the program is started.
-  # The logo is always suppressed if STDOUT is not a TTY.
-  # suppress-logo = false
-
-###
-### [subscriber]
-###
-### Controls the subscriptions, which can be used to fork a copy of all data
-### received by the InfluxDB host.
-###
-
 [subscriber]
-  # Determines whether the subscriber service is enabled.
-  # enabled = true
-
-  # The default timeout for HTTP writes to subscribers.
-  # http-timeout = "30s"
-
-  # Allows insecure HTTPS connections to subscribers.  This is useful when testing with self-
-  # signed certificates.
-  # insecure-skip-verify = false
-
-  # The path to the PEM encoded CA certs file. If the empty string, the default system certs will be used
-  # ca-certs = ""
-
-  # The number of writer goroutines processing the write channel.
-  # write-concurrency = 40
-
-  # The number of in-flight writes buffered in the write channel.
-  # write-buffer-size = 1000
-
-
-###
-### [[graphite]]
-###
-### Controls one or many listeners for Graphite data.
-###
-
 [[graphite]]
-  # Determines whether the graphite endpoint is enabled.
-  # enabled = false
-  # database = "graphite"
-  # retention-policy = ""
-  # bind-address = ":2003"
-  # protocol = "tcp"
-  # consistency-level = "one"
-
-  # These next lines control how batching works. You should have this enabled
-  # otherwise you could get dropped metrics or poor performance. Batching
-  # will buffer points in memory if you have many coming in.
-
-  # Flush if this many points get buffered
-  # batch-size = 5000
-
-  # number of batches that may be pending in memory
-  # batch-pending = 10
-
-  # Flush at least this often even if we haven't hit buffer limit
-  # batch-timeout = "1s"
-
-  # UDP Read buffer size, 0 means OS default. UDP listener will fail if set above OS max.
-  # udp-read-buffer = 0
-
-  ### This string joins multiple matching 'measurement' values providing more control over the final measurement name.
-  # separator = "."
-
-  ### Default tags that will be added to all metrics.  These can be overridden at the template level
-  ### or by tags extracted from metric
-  # tags = ["region=us-east", "zone=1c"]
-
-  ### Each template line requires a template pattern.  It can have an optional
-  ### filter before the template and separated by spaces.  It can also have optional extra
-  ### tags following the template.  Multiple tags should be separated by commas and no spaces
-  ### similar to the line protocol format.  There can be only one default template.
-  # templates = [
-  #   "*.app env.service.resource.measurement",
-  #   # Default template
-  #   "server.*",
-  # ]
-
-###
-### [collectd]
-###
-### Controls one or many listeners for collectd data.
-###
-
 [[collectd]]
-  # enabled = false
-  # bind-address = ":25826"
-  # database = "collectd"
-  # retention-policy = ""
-  #
-  # The collectd service supports either scanning a directory for multiple types
-  # db files, or specifying a single db file.
-  # typesdb = "/usr/local/share/collectd"
-  #
-  # security-level = "none"
-  # auth-file = "/etc/collectd/auth_file"
-
-  # These next lines control how batching works. You should have this enabled
-  # otherwise you could get dropped metrics or poor performance. Batching
-  # will buffer points in memory if you have many coming in.
-
-  # Flush if this many points get buffered
-  # batch-size = 5000
-
-  # Number of batches that may be pending in memory
-  # batch-pending = 10
-
-  # Flush at least this often even if we haven't hit buffer limit
-  # batch-timeout = "10s"
-
-  # UDP Read buffer size, 0 means OS default. UDP listener will fail if set above OS max.
-  # read-buffer = 0
-
-  # Multi-value plugins can be handled two ways.
-  # "split" will parse and store the multi-value plugin data into separate measurements
-  # "join" will parse and store the multi-value plugin as a single multi-value measurement.
-  # "split" is the default behavior for backward compatibility with previous versions of influxdb.
-  # parse-multivalue-plugin = "split"
-###
-### [opentsdb]
-###
-### Controls one or many listeners for OpenTSDB data.
-###
-
 [[opentsdb]]
-  # enabled = false
-  # bind-address = ":4242"
-  # database = "opentsdb"
-  # retention-policy = ""
-  # consistency-level = "one"
-  # tls-enabled = false
-  # certificate= "/etc/ssl/influxdb.pem"
-
-  # Log an error for every malformed point.
-  # log-point-errors = true
-
-  # These next lines control how batching works. You should have this enabled
-  # otherwise you could get dropped metrics or poor performance. Only points
-  # metrics received over the telnet protocol undergo batching.
-
-  # Flush if this many points get buffered
-  # batch-size = 1000
-
-  # Number of batches that may be pending in memory
-  # batch-pending = 5
-
-  # Flush at least this often even if we haven't hit buffer limit
-  # batch-timeout = "1s"
-
-###
-### [[udp]]
-###
-### Controls the listeners for InfluxDB line protocol data via UDP.
-###
-
 [[udp]]
-  # enabled = false
-  # bind-address = ":8089"
-  # database = "udp"
-  # retention-policy = ""
-
-  # InfluxDB precision for timestamps on received points ("" or "n", "u", "ms", "s", "m", "h")
-  # precision = ""
-
-  # These next lines control how batching works. You should have this enabled
-  # otherwise you could get dropped metrics or poor performance. Batching
-  # will buffer points in memory if you have many coming in.
-
-  # Flush if this many points get buffered
-  # batch-size = 5000
-
-  # Number of batches that may be pending in memory
-  # batch-pending = 10
-
-  # Will flush at least this often even if we haven't hit buffer limit
-  # batch-timeout = "1s"
-
-  # UDP Read buffer size, 0 means OS default. UDP listener will fail if set above OS max.
-  # read-buffer = 0
-
-###
-### [continuous_queries]
-###
-### Controls how continuous queries are run within InfluxDB.
-###
-
 [continuous_queries]
-  # Determines whether the continuous query service is enabled.
-  # enabled = true
-
-  # Controls whether queries are logged when executed by the CQ service.
-  # log-enabled = true
-
-  # Controls whether queries are logged to the self-monitoring data store.
-  # query-stats-enabled = false
-
-  # interval for how often continuous queries will be checked if they need to run
-  # run-interval = "1s"
-
-###
-### [tls]
-###
-### Global configuration settings for TLS in InfluxDB.
-###
-
 [tls]
-  # Determines the available set of cipher suites. See https://golang.org/pkg/crypto/tls/#pkg-constants
-  # for a list of available ciphers, which depends on the version of Go (use the query
-  # SHOW DIAGNOSTICS to see the version of Go used to build InfluxDB). If not specified, uses
-  # the default settings from Go's crypto/tls package.
-  # ciphers = [
-  #   "TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305",
-  #   "TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305",
-  # ]
-
-  # Minimum version of the tls protocol that will be negotiated. If not specified, uses the
-  # default settings from Go's crypto/tls package.
-  # min-version = "tls1.2"
-
-  # Maximum version of the tls protocol that will be negotiated. If not specified, uses the
-  # default settings from Go's crypto/tls package.
-  # max-version = "tls1.3"

changed: [manmanmano-2]
 ____________________________________
< TASK [influxdb : Service influxdb] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
 ____________________________________
< TASK [influxdb : Install telegraf] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


The following NEW packages will be installed:
  telegraf
0 upgraded, 1 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-2]
 ______________________________________
< TASK [influxdb : Copy telegraf.conf] >
 --------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


diff skipped: destination file size is greater than 104448
changed: [manmanmano-2]
 ____________________________________
< TASK [influxdb : Service telegraf] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 __________________________________________________________
< TASK [influxdb_exporter : Copy influxdb-exporter binary] >
 ----------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


diff skipped: source file size is greater than 104448
changed: [manmanmano-2]
 ________________________________
/ TASK [influxdb_exporter : Copy \
\ prometheus-influxdb-exporter]  /
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/influxdb_exporter/files/prometheus-influxdb-stats-exporter.service
@@ -0,0 +1,11 @@
+[Unit]                                                                          
+Description=InfluxDB exporter for metrics on influx
+Documentation=https://github.com/carlpett/influxdb_stats_exporter
+After=network-online.target                                                     
+                                                                                
+[Service]                                                                       
+User=prometheus
+ExecStart=/usr/local/bin/prometheus-influxdb-stats-exporter
+                                                                                
+[Install]                                                                       
+WantedBy=multi-user.target  

changed: [manmanmano-2]
 ___________________________________
/ TASK [influxdb_exporter : Service \
\ prometheus-influxdb-exporter]     /
 -----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
 _____________________________________________________________
< TASK [influxdb_backup : Create a directory for user backup] >
 -------------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/influxdb",
-    "state": "absent"
+    "state": "directory"
 }

changed: [manmanmano-2]
 ___________________________________________
< TASK [influxdb_backup : InfluxDB crontab] >
 -------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after: /home/jimi/.ansible/tmp/ansible-local-35565r8nz1hs2/tmp_wc0y7hr/influxdb-backup.j2
@@ -0,0 +1,3 @@
+00 00 * * * backup rm -rf /home/backup/influxdb/*; influxd backup -database telegraf /home/backup/influxdb
+10 00 * * 0 backup duplicity --no-encryption full /home/backup/influxdb/ rsync://manmanmano@backup.clounsible.mano//home/manmanmano/influxdb/
+10 00 * * 1-6 backup duplicity --no-encryption incremental /home/backup/influxdb/ rsync://manmanmano@backup.clounsible.mano//home/manmanmano/influxdb

changed: [manmanmano-2]
 _______________________________________________
< RUNNING HANDLER [influxdb : Restart telegraf] >
 -----------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
 _______________________________________________
< RUNNING HANDLER [influxdb : Restart influxdb] >
 -----------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
 ______________________________________________________
< RUNNING HANDLER [influxdb_exporter : Reload daemons] >
 ------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
 ______________________________________________
/ RUNNING HANDLER [influxdb_exporter : Restart \
\ influxdb-exporter]                           /
 ----------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
 _______________
< PLAY [Pinger] >
 ---------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 _______________________________
< TASK [pinger : Install fping] >
 -------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


The following NEW packages will be installed:
  fping
0 upgraded, 1 newly installed, 0 to remove and 137 not upgraded.
changed: [manmanmano-2]
 ____________________________________
< TASK [pinger : Create user pinger] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
 __________________________________
< TASK [pinger : Copy pinger.conf] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/pinger/files/pinger.conf
@@ -0,0 +1,3 @@
+database_url=http://influxdb:8086
+database_name=latency
+targets=google.com,cloudflare.com,twitter.com

changed: [manmanmano-2]
 ________________________________
< TASK [pinger : Copy pinger.sh] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/pinger/files/pinger.sh
@@ -0,0 +1,26 @@
+#!/bin/bash
+
+# Script contains several (more than 1) security issues.
+# Find them and fix them to get bonus on exam.
+# Problem example: SQL injection.
+
+for t in database_url database_name targets; do
+  if ! grep -q "^${t}=" /etc/pinger/pinger.conf; then
+    logger "$0 Failed to get $t from config"
+    exit 1
+  fi
+done
+
+which fping > /dev/null || (logger "fping not found"; exit 1)
+
+db_url=$(grep "^database_url=" /etc/pinger/pinger.conf | sed 's/^.*=//')
+db_name=$(grep "^database_name=" /etc/pinger/pinger.conf | sed 's/^.*=//')
+targets=$(grep "^targets=" /etc/pinger/pinger.conf | sed 's/^.*=//' | sed 's/\(,\|;\)/ /g')
+
+curl -i -XPOST "${db_url}/query" --data-urlencode "q=CREATE DATABASE $db_name" 1>/dev/null 2>/dev/null
+
+while true; do
+  result=$(fping -C1 -q $targets 2>&1 | awk -v db=$db_name '{print db",dst="$1" rtt="$3}')
+  curl -i -XPOST "${db_url}/write?db=$db_name" --data-binary "$result" 1>/dev/null 2>/dev/null
+ sleep 1
+done

changed: [manmanmano-2]
 _____________________________________
< TASK [pinger : Copy pinger.service] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/pinger/files/pinger.service
@@ -0,0 +1,11 @@
+[Unit]
+Description=Pinger uses the command fping to retrieve metrics from fpinged websites
+Documentation=https://github.com/romankuchin/ica0002-2021/blob/main/08-logging/08-files/pinger.service
+After=network-online.target
+
+[Service]
+User=pinger
+ExecStart=/usr/local/bin/pinger
+
+[Install]
+WantedBy=multi-user.target

changed: [manmanmano-2]
 ________________________________
< TASK [pinger : Pinger service] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
 ___________________________________________
< RUNNING HANDLER [pinger : Reload daemons] >
 -------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
 ___________________________________________
< RUNNING HANDLER [pinger : Restart pinger] >
 -------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-2]
 ________________
< PLAY [Rsyslog] >
 ----------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 __________________________________
< TASK [rsyslog : Service rsyslog] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 ________________________________________
< TASK [rsyslog : Copy 10-telegraf.conf] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/rsyslog/files/10-telegraf.conf
@@ -0,0 +1,7 @@
+$ActionQueueType LinkedList # use asynchronous processing
+$ActionQueueFileName srvrfwd # set file name, also enables disk mode
+$ActionResumeRetryCount -1 # infinite retries on insert failure
+$ActionQueueSaveOnShutdown on # save in-memory data if rsyslog shuts down
+
+# uncomment to use udp according to RFC 5424
+*.* @influxdb:6514;RSYSLOG_SyslogProtocol23Format

changed: [manmanmano-1]
--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/rsyslog/files/10-telegraf.conf
@@ -0,0 +1,7 @@
+$ActionQueueType LinkedList # use asynchronous processing
+$ActionQueueFileName srvrfwd # set file name, also enables disk mode
+$ActionResumeRetryCount -1 # infinite retries on insert failure
+$ActionQueueSaveOnShutdown on # save in-memory data if rsyslog shuts down
+
+# uncomment to use udp according to RFC 5424
+*.* @influxdb:6514;RSYSLOG_SyslogProtocol23Format

changed: [manmanmano-2]
--- before
+++ after: /home/jimi/Documents/TalTech/Roman/ica0002/roles/rsyslog/files/10-telegraf.conf
@@ -0,0 +1,7 @@
+$ActionQueueType LinkedList # use asynchronous processing
+$ActionQueueFileName srvrfwd # set file name, also enables disk mode
+$ActionResumeRetryCount -1 # infinite retries on insert failure
+$ActionQueueSaveOnShutdown on # save in-memory data if rsyslog shuts down
+
+# uncomment to use udp according to RFC 5424
+*.* @influxdb:6514;RSYSLOG_SyslogProtocol23Format

changed: [manmanmano-3]
 _____________________________________________
< RUNNING HANDLER [rsyslog : Restart rsyslog] >
 ---------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


changed: [manmanmano-1]
changed: [manmanmano-3]
changed: [manmanmano-2]
 ____________
< PLAY RECAP >
 ------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


manmanmano-1               : ok=79   changed=67   unreachable=0    failed=0    skipped=6    rescued=0    ignored=0   
manmanmano-2               : ok=120  changed=107  unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
manmanmano-3               : ok=78   changed=67   unreachable=0    failed=0    skipped=6    rescued=0    ignored=0   

+ ansible-playbook infra.yaml --diff
 ___________________________________
< PLAY [Collect info about all VMs] >
 -----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ________________________
< TASK [Gathering Facts] >
 ------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 ______________
< TASK [setup] >
 --------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 _____________
< PLAY [Init] >
 -------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ________________________________
< TASK [init : Update APT cache] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-2]
ok: [manmanmano-1]
 ___________________________________________________________
< TASK [backup : Add the user backup and generate ssh keys] >
 -----------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 __________________________________________________________
< TASK [backup : Create directory restore for user backup] >
 ----------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ___________________________________
< TASK [backup : Install duplicity] >
 -----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 __________________________________
< TASK [backup : Copy known_hosts] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 ___________________
< PLAY [DNS server] >
 -------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 _______________________________________
< TASK [bind : Install package "bind9"] >
 ---------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 ____________________________
< TASK [bind : Service bind] >
 ----------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 ____________________________________
< TASK [bind : Copy db.startup_name] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-1]
skipping: [manmanmano-3]
ok: [manmanmano-2]
 _______________________________
< TASK [bind : Copy db.reverse] >
 -------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-1]
skipping: [manmanmano-3]
ok: [manmanmano-2]
 ___________________________________________
< TASK [bind : Copy new named.conf.options] >
 -------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 _________________________________________
< TASK [bind : Copy new named.conf.local] >
 -----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 _________________________________________________________
/ TASK [bind : Force notified handlers to restart at this \
\ point]                                                  /
 ---------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 __________________________________
< TASK [bind : Nsupdate A records] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-1] => (item={'key': 'backup', 'value': '192.168.42.156'}) 
skipping: [manmanmano-3] => (item={'key': 'backup', 'value': '192.168.42.156'}) 
ok: [manmanmano-2] => (item={'key': 'backup', 'value': '192.168.42.156'})
 ______________________________________
< TASK [bind : Nsupdate CNAME records] >
 --------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-1] => (item={'key': 'grafana', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'influxdb', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'lb1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-1] => (item={'key': 'lb2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'grafana', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'influxdb', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'lb3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-3] => (item={'key': 'lb1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-1] => (item={'key': 'mysql1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-3] => (item={'key': 'lb2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'mysql2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'lb3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-1] => (item={'key': 'mysql3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-3] => (item={'key': 'mysql1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-1] => (item={'key': 'ns1', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'ns2', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-3] => (item={'key': 'mysql2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'ns3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-3] => (item={'key': 'mysql3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-1] => (item={'key': 'prometheus', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'ns1', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'web1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-3] => (item={'key': 'ns2', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-3] => (item={'key': 'ns3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-1] => (item={'key': 'web2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'web3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-3] => (item={'key': 'prometheus', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'web1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-3] => (item={'key': 'web2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'web3', 'value': 'manmanmano-3'}) 
ok: [manmanmano-2] => (item={'key': 'grafana', 'value': 'manmanmano-2'})
ok: [manmanmano-2] => (item={'key': 'influxdb', 'value': 'manmanmano-2'})
ok: [manmanmano-2] => (item={'key': 'lb1', 'value': 'manmanmano-1'})
ok: [manmanmano-2] => (item={'key': 'lb2', 'value': 'manmanmano-2'})
ok: [manmanmano-2] => (item={'key': 'lb3', 'value': 'manmanmano-3'})
ok: [manmanmano-2] => (item={'key': 'mysql1', 'value': 'manmanmano-1'})
ok: [manmanmano-2] => (item={'key': 'mysql2', 'value': 'manmanmano-2'})
ok: [manmanmano-2] => (item={'key': 'mysql3', 'value': 'manmanmano-3'})
ok: [manmanmano-2] => (item={'key': 'ns1', 'value': 'manmanmano-2'})
ok: [manmanmano-2] => (item={'key': 'ns2', 'value': 'manmanmano-1'})
ok: [manmanmano-2] => (item={'key': 'ns3', 'value': 'manmanmano-3'})
ok: [manmanmano-2] => (item={'key': 'prometheus', 'value': 'manmanmano-2'})
ok: [manmanmano-2] => (item={'key': 'web1', 'value': 'manmanmano-1'})
ok: [manmanmano-2] => (item={'key': 'web2', 'value': 'manmanmano-2'})
ok: [manmanmano-2] => (item={'key': 'web3', 'value': 'manmanmano-3'})
 _________________________________________________________
< TASK [bind_exporter : Install prometheus-bind-exporter] >
 ---------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 ______________________________________________
< TASK [bind_exporter : Service bind-exporter] >
 ----------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 _________________________
< PLAY [Systemd-resolved] >
 -------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ____________________________________________
< TASK [systemd-resolved : Copy resolv.conf] >
 --------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 _________________________________________________
< TASK [systemd-resolved : Stop systemd-resolved] >
 -------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ______________________
< PLAY [Node exporter] >
 ----------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ______________________________________________
< TASK [node_exporter : install node-exporter] >
 ----------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ______________________________________________
< TASK [node_exporter : Service node-exporter] >
 ----------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-2]
ok: [manmanmano-1]
 ________________________
< PLAY [Database server] >
 ------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ________________________________________
< TASK [mysql : Install package "mysql"] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 __________________________________________________
< TASK [mysql : Install package "python3-pymysql"] >
 --------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ______________________________
< TASK [mysql : MySQL service] >
 ------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-3]
ok: [manmanmano-2]
 _______________________________
< TASK [mysql : MySQL database] >
 -------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-3]
ok: [manmanmano-2]
 ___________________________
< TASK [mysql : MySQL user] >
 ---------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-3]
ok: [manmanmano-2]
 _________________________________
< TASK [mysql : Replication user] >
 ---------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 ____________________________________
/ TASK [mysql : copy override.cnf to \
\ /etc/mysql/mysql.conf.d/]          /
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 ____________________________________________________________
< TASK [mysql : Force notified handler to restart MySQL now] >
 ------------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 _________________________________________
< TASK [mysql : MySQL replica RO mode on] >
 -----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 __________________________________________
< TASK [mysql : MySQL primary R0 mode off] >
 ------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-1]
skipping: [manmanmano-3]
ok: [manmanmano-2]
 ________________________________________________
< TASK [mysql_exporter : install mysql-exporter] >
 ------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 __________________________________________
< TASK [mysql_exporter : Pause for 10 sec] >
 ------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-1]
 _____________________________________________
< TASK [mysql_exporter : MySQL exporter user] >
 ---------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-2]
ok: [manmanmano-1]
 ________________________________
< TASK [mysql_exporter : my.cnf] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 __________________________________________
/ TASK [mysql_exporter :                   \
\ /etc/default/prometheus-mysqld-exporter] /
 ------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 _________________________________
< TASK [mysql_exporter : service] >
 ---------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 __________________________________________________________
< TASK [mysql_backup : Create a directory for user backup] >
 ----------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-3]
ok: [manmanmano-2]
 _____________________________________
< TASK [mysql_backup : backup my.cnf] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 _________________________________________
< TASK [mysql_backup : MySQL user backup] >
 -----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 _____________________________________
< TASK [mysql_backup : MySQL crontab] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-2]
ok: [manmanmano-1]
 ______________
< PLAY [NGINX] >
 --------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ____________________________________________
< TASK [nginx : Install the package "nginx"] >
 --------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 ___________________________________
/ TASK [nginx : Copy default to     \
\ /etc/nginx/sites-enabled/default] /
 -----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ______________________________
< TASK [nginx : Nginx service] >
 ------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ________________________________________________
< TASK [nginx_exporter : Install nginx-exporter] >
 ------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 ________________________________________________
< TASK [nginx_exporter : Service nginx-exporter] >
 ------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 _______________________________________
< TASK [nginx_exporter : exporter file] >
 ---------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 ______________________________
< PLAY [Haproxy and Keepalive] >
 ------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 __________________________________
< TASK [haproxy : Install HAProxy] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 _________________________________
< TASK [haproxy : haproxy config] >
 ---------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 __________________________________
< TASK [haproxy : Service haproxy] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ____________________________________________________
< TASK [haproxy_exporter : Install haproxy exporter] >
 ----------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 ___________________________________________________
< TASK [haproxy_exporter : haproxy exporter config] >
 ---------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-2]
ok: [manmanmano-1]
 __________________________________
/ TASK [haproxy_exporter : Service \
\ prometheus-haproxy-exporter]     /
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 ________________________________________
< TASK [keepalived : Install keepalived] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 _______________________________________
< TASK [keepalived : keepalived script] >
 ---------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 _____________________________________
< TASK [keepalived : keepalived.conf] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 ________________________________________
< TASK [keepalived : Service keepalived] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3] => (item=haproxy)
ok: [manmanmano-2] => (item=haproxy)
ok: [manmanmano-1] => (item=haproxy)
ok: [manmanmano-1] => (item=keepalived)
ok: [manmanmano-3] => (item=keepalived)
ok: [manmanmano-2] => (item=keepalived)
 ______________________________________________________
/ TASK [keepalived_exporter : Copy keepalived-exporter \
\ binary]                                              /
 ------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-3]
ok: [manmanmano-2]
 __________________________________
/ TASK [keepalived_exporter : Copy \
\ keepalived-exporter.service]     /
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 __________________________________________________________
< TASK [keepalived_exporter : Keepalived-exporter service] >
 ----------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-3]
ok: [manmanmano-2]
 ___________________
< PLAY [Docker bug] >
 -------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 _______________________________________________
< TASK [iptables : Install iptables-persistent] >
 -----------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-2]
ok: [manmanmano-1]
 __________________________________________
< TASK [iptables : Fix ssl bug for docker] >
 ------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ________________________________
< TASK [iptables : Load on boot] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-3]
ok: [manmanmano-2]
 ____________________________________
< TASK [iptables : Restore iptables] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


[WARNING]: Attempts to restore iptables state without rollback in case of
mistake may lead the ansible controller to loose access to the hosts and never
regain it before fixing firewall rules through a serial console, or any other
way except SSH. Please set task attribute 'poll' (=15) to 0, and 'async' (=0)
to a value >2 and not greater than 'ansible_timeout' (=10) (recommended).
[WARNING]: Attempts to restore iptables state without rollback in case of
mistake may lead the ansible controller to loose access to the hosts and never
regain it before fixing firewall rules through a serial console, or any other
way except SSH. Please set task attribute 'poll' (=15) to 0, and 'async' (=0)
to a value >2 and not greater than 'ansible_timeout' (=10) (recommended).
[WARNING]: Attempts to restore iptables state without rollback in case of
mistake may lead the ansible controller to loose access to the hosts and never
regain it before fixing firewall rules through a serial console, or any other
way except SSH. Please set task attribute 'poll' (=15) to 0, and 'async' (=0)
to a value >2 and not greater than 'ansible_timeout' (=10) (recommended).
ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 _______________
< PLAY [Docker] >
 ---------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ________________________________
< TASK [docker : Docker package] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 ________________________________
< TASK [docker : Docker service] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ______________
< PLAY [Agama] >
 --------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ___________________________
< TASK [agama : /opt/agama] >
 ---------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 ____________________________________
< TASK [agama : Download dockerfile] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 ____________________________
< TASK [agama : Agama image] >
 ----------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 _________________________________
< TASK [agama : Agama containers] >
 ---------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3] => (item={'key': 'agama-1', 'value': 8001})
ok: [manmanmano-2] => (item={'key': 'agama-1', 'value': 8001})
ok: [manmanmano-1] => (item={'key': 'agama-1', 'value': 8001})
ok: [manmanmano-1] => (item={'key': 'agama-2', 'value': 8010})
ok: [manmanmano-3] => (item={'key': 'agama-2', 'value': 8010})
ok: [manmanmano-2] => (item={'key': 'agama-2', 'value': 8010})
 ___________________
< PLAY [Prometheus] >
 -------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ________________________________________
< TASK [prometheus : Install Prometheus] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ________________________________________
< TASK [prometheus : Service prometheus] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 _____________________________________
< TASK [prometheus : prometheus.yaml] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 _____________________________________________
< TASK [prometheus : /etc/default/prometheus] >
 ---------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ________________
< PLAY [Grafana] >
 ----------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ____________________________________
< TASK [grafana : Grafana directory] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ________________________________________
< TASK [grafana : Grafana configuration] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ___________________________________________________
< TASK [grafana : Grafana dashboard and datasource] >
 ---------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2] => (item=dashboards)
ok: [manmanmano-2] => (item=datasources)
 _____________________________________
< TASK [grafana : Grafana dashboards] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2] => (item={'src': 'dashboard.yaml', 'dest': 'dashboards'})
ok: [manmanmano-2] => (item={'src': 'datasource.yaml', 'dest': 'datasources'})
 _____________________________________
< TASK [grafana : Grafana dashboards] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2] => (item={'src': 'main.json', 'dest': 'main.json'})
ok: [manmanmano-2] => (item={'src': 'mysql.json', 'dest': 'mysql.json'})
ok: [manmanmano-2] => (item={'src': 'syslog.json', 'dest': 'syslog.json'})
 ___________________________________________
< TASK [grafana : Grafana docker container] >
 -------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 _________________
< PLAY [InfluxDB] >
 -----------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ____________________________
< TASK [influxdb : Repo key] >
 ----------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 _____________________________________
< TASK [influxdb : Add influxdb repo] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ____________________________________
< TASK [influxdb : Install influxdb] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ______________________________________
< TASK [influxdb : Copy influxdb.conf] >
 --------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ____________________________________
< TASK [influxdb : Service influxdb] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ____________________________________
< TASK [influxdb : Install telegraf] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ______________________________________
< TASK [influxdb : Copy telegraf.conf] >
 --------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ____________________________________
< TASK [influxdb : Service telegraf] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 __________________________________________________________
< TASK [influxdb_exporter : Copy influxdb-exporter binary] >
 ----------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ________________________________
/ TASK [influxdb_exporter : Copy \
\ prometheus-influxdb-exporter]  /
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ___________________________________
/ TASK [influxdb_exporter : Service \
\ prometheus-influxdb-exporter]     /
 -----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 _____________________________________________________________
< TASK [influxdb_backup : Create a directory for user backup] >
 -------------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ___________________________________________
< TASK [influxdb_backup : InfluxDB crontab] >
 -------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 _______________
< PLAY [Pinger] >
 ---------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 _______________________________
< TASK [pinger : Install fping] >
 -------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ____________________________________
< TASK [pinger : Create user pinger] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 __________________________________
< TASK [pinger : Copy pinger.conf] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ________________________________
< TASK [pinger : Copy pinger.sh] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 _____________________________________
< TASK [pinger : Copy pinger.service] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ________________________________
< TASK [pinger : Pinger service] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ________________
< PLAY [Rsyslog] >
 ----------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 __________________________________
< TASK [rsyslog : Service rsyslog] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ________________________________________
< TASK [rsyslog : Copy 10-telegraf.conf] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 ____________
< PLAY RECAP >
 ------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


manmanmano-1               : ok=65   changed=0    unreachable=0    failed=0    skipped=6    rescued=0    ignored=0   
manmanmano-2               : ok=98   changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
manmanmano-3               : ok=65   changed=0    unreachable=0    failed=0    skipped=5    rescued=0    ignored=0   

+ ansible all -b -m reboot -a test_command=uptime
manmanmano-1 | CHANGED => {
    "changed": true,
    "elapsed": 42,
    "rebooted": true
}
manmanmano-3 | CHANGED => {
    "changed": true,
    "elapsed": 43,
    "rebooted": true
}
manmanmano-2 | CHANGED => {
    "changed": true,
    "elapsed": 45,
    "rebooted": true
}
+ ansible-playbook infra.yaml --diff
 ___________________________________
< PLAY [Collect info about all VMs] >
 -----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ________________________
< TASK [Gathering Facts] >
 ------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 ______________
< TASK [setup] >
 --------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 _____________
< PLAY [Init] >
 -------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ________________________________
< TASK [init : Update APT cache] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 ___________________________________________________________
< TASK [backup : Add the user backup and generate ssh keys] >
 -----------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-3]
ok: [manmanmano-2]
 __________________________________________________________
< TASK [backup : Create directory restore for user backup] >
 ----------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 ___________________________________
< TASK [backup : Install duplicity] >
 -----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 __________________________________
< TASK [backup : Copy known_hosts] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 ___________________
< PLAY [DNS server] >
 -------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 _______________________________________
< TASK [bind : Install package "bind9"] >
 ---------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ____________________________
< TASK [bind : Service bind] >
 ----------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 ____________________________________
< TASK [bind : Copy db.startup_name] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-1]
skipping: [manmanmano-3]
ok: [manmanmano-2]
 _______________________________
< TASK [bind : Copy db.reverse] >
 -------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-1]
skipping: [manmanmano-3]
ok: [manmanmano-2]
 ___________________________________________
< TASK [bind : Copy new named.conf.options] >
 -------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-3]
ok: [manmanmano-2]
 _________________________________________
< TASK [bind : Copy new named.conf.local] >
 -----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-3]
ok: [manmanmano-2]
 _________________________________________________________
/ TASK [bind : Force notified handlers to restart at this \
\ point]                                                  /
 ---------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 __________________________________
< TASK [bind : Nsupdate A records] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-1] => (item={'key': 'backup', 'value': '192.168.42.156'}) 
skipping: [manmanmano-3] => (item={'key': 'backup', 'value': '192.168.42.156'}) 
ok: [manmanmano-2] => (item={'key': 'backup', 'value': '192.168.42.156'})
 ______________________________________
< TASK [bind : Nsupdate CNAME records] >
 --------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-1] => (item={'key': 'grafana', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'influxdb', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'lb1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-3] => (item={'key': 'grafana', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'lb2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'influxdb', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'lb3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-3] => (item={'key': 'lb1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-1] => (item={'key': 'mysql1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-3] => (item={'key': 'lb2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'mysql2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'lb3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-1] => (item={'key': 'mysql3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-3] => (item={'key': 'mysql1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-3] => (item={'key': 'mysql2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'ns1', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'mysql3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-1] => (item={'key': 'ns2', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-3] => (item={'key': 'ns1', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'ns3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-3] => (item={'key': 'ns2', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-1] => (item={'key': 'prometheus', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'ns3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-1] => (item={'key': 'web1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-3] => (item={'key': 'prometheus', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'web2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-1] => (item={'key': 'web3', 'value': 'manmanmano-3'}) 
skipping: [manmanmano-3] => (item={'key': 'web1', 'value': 'manmanmano-1'}) 
skipping: [manmanmano-3] => (item={'key': 'web2', 'value': 'manmanmano-2'}) 
skipping: [manmanmano-3] => (item={'key': 'web3', 'value': 'manmanmano-3'}) 
ok: [manmanmano-2] => (item={'key': 'grafana', 'value': 'manmanmano-2'})
ok: [manmanmano-2] => (item={'key': 'influxdb', 'value': 'manmanmano-2'})
ok: [manmanmano-2] => (item={'key': 'lb1', 'value': 'manmanmano-1'})
ok: [manmanmano-2] => (item={'key': 'lb2', 'value': 'manmanmano-2'})
ok: [manmanmano-2] => (item={'key': 'lb3', 'value': 'manmanmano-3'})
ok: [manmanmano-2] => (item={'key': 'mysql1', 'value': 'manmanmano-1'})
ok: [manmanmano-2] => (item={'key': 'mysql2', 'value': 'manmanmano-2'})
ok: [manmanmano-2] => (item={'key': 'mysql3', 'value': 'manmanmano-3'})
ok: [manmanmano-2] => (item={'key': 'ns1', 'value': 'manmanmano-2'})
ok: [manmanmano-2] => (item={'key': 'ns2', 'value': 'manmanmano-1'})
ok: [manmanmano-2] => (item={'key': 'ns3', 'value': 'manmanmano-3'})
ok: [manmanmano-2] => (item={'key': 'prometheus', 'value': 'manmanmano-2'})
ok: [manmanmano-2] => (item={'key': 'web1', 'value': 'manmanmano-1'})
ok: [manmanmano-2] => (item={'key': 'web2', 'value': 'manmanmano-2'})
ok: [manmanmano-2] => (item={'key': 'web3', 'value': 'manmanmano-3'})
 _________________________________________________________
< TASK [bind_exporter : Install prometheus-bind-exporter] >
 ---------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ______________________________________________
< TASK [bind_exporter : Service bind-exporter] >
 ----------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 _________________________
< PLAY [Systemd-resolved] >
 -------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ____________________________________________
< TASK [systemd-resolved : Copy resolv.conf] >
 --------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 _________________________________________________
< TASK [systemd-resolved : Stop systemd-resolved] >
 -------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-2]
ok: [manmanmano-1]
 ______________________
< PLAY [Node exporter] >
 ----------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ______________________________________________
< TASK [node_exporter : install node-exporter] >
 ----------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 ______________________________________________
< TASK [node_exporter : Service node-exporter] >
 ----------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 ________________________
< PLAY [Database server] >
 ------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ________________________________________
< TASK [mysql : Install package "mysql"] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-3]
ok: [manmanmano-2]
 __________________________________________________
< TASK [mysql : Install package "python3-pymysql"] >
 --------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ______________________________
< TASK [mysql : MySQL service] >
 ------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-2]
ok: [manmanmano-1]
 _______________________________
< TASK [mysql : MySQL database] >
 -------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 ___________________________
< TASK [mysql : MySQL user] >
 ---------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-2]
ok: [manmanmano-1]
 _________________________________
< TASK [mysql : Replication user] >
 ---------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-3]
ok: [manmanmano-2]
 ____________________________________
/ TASK [mysql : copy override.cnf to \
\ /etc/mysql/mysql.conf.d/]          /
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-2]
ok: [manmanmano-1]
 ____________________________________________________________
< TASK [mysql : Force notified handler to restart MySQL now] >
 ------------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 _________________________________________
< TASK [mysql : MySQL replica RO mode on] >
 -----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 __________________________________________
< TASK [mysql : MySQL primary R0 mode off] >
 ------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-1]
skipping: [manmanmano-3]
ok: [manmanmano-2]
 ________________________________________________
< TASK [mysql_exporter : install mysql-exporter] >
 ------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-3]
ok: [manmanmano-2]
 __________________________________________
< TASK [mysql_exporter : Pause for 10 sec] >
 ------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


skipping: [manmanmano-1]
 _____________________________________________
< TASK [mysql_exporter : MySQL exporter user] >
 ---------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 ________________________________
< TASK [mysql_exporter : my.cnf] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-2]
ok: [manmanmano-1]
 __________________________________________
/ TASK [mysql_exporter :                   \
\ /etc/default/prometheus-mysqld-exporter] /
 ------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 _________________________________
< TASK [mysql_exporter : service] >
 ---------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 __________________________________________________________
< TASK [mysql_backup : Create a directory for user backup] >
 ----------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 _____________________________________
< TASK [mysql_backup : backup my.cnf] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 _________________________________________
< TASK [mysql_backup : MySQL user backup] >
 -----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 _____________________________________
< TASK [mysql_backup : MySQL crontab] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ______________
< PLAY [NGINX] >
 --------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ____________________________________________
< TASK [nginx : Install the package "nginx"] >
 --------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 ___________________________________
/ TASK [nginx : Copy default to     \
\ /etc/nginx/sites-enabled/default] /
 -----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-2]
ok: [manmanmano-1]
 ______________________________
< TASK [nginx : Nginx service] >
 ------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ________________________________________________
< TASK [nginx_exporter : Install nginx-exporter] >
 ------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 ________________________________________________
< TASK [nginx_exporter : Service nginx-exporter] >
 ------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 _______________________________________
< TASK [nginx_exporter : exporter file] >
 ---------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ______________________________
< PLAY [Haproxy and Keepalive] >
 ------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 __________________________________
< TASK [haproxy : Install HAProxy] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 _________________________________
< TASK [haproxy : haproxy config] >
 ---------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 __________________________________
< TASK [haproxy : Service haproxy] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 ____________________________________________________
< TASK [haproxy_exporter : Install haproxy exporter] >
 ----------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 ___________________________________________________
< TASK [haproxy_exporter : haproxy exporter config] >
 ---------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 __________________________________
/ TASK [haproxy_exporter : Service \
\ prometheus-haproxy-exporter]     /
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-2]
ok: [manmanmano-1]
 ________________________________________
< TASK [keepalived : Install keepalived] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 _______________________________________
< TASK [keepalived : keepalived script] >
 ---------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 _____________________________________
< TASK [keepalived : keepalived.conf] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 ________________________________________
< TASK [keepalived : Service keepalived] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3] => (item=haproxy)
ok: [manmanmano-2] => (item=haproxy)
ok: [manmanmano-1] => (item=haproxy)
ok: [manmanmano-3] => (item=keepalived)
ok: [manmanmano-1] => (item=keepalived)
ok: [manmanmano-2] => (item=keepalived)
 ______________________________________________________
/ TASK [keepalived_exporter : Copy keepalived-exporter \
\ binary]                                              /
 ------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 __________________________________
/ TASK [keepalived_exporter : Copy \
\ keepalived-exporter.service]     /
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 __________________________________________________________
< TASK [keepalived_exporter : Keepalived-exporter service] >
 ----------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-3]
ok: [manmanmano-2]
 ___________________
< PLAY [Docker bug] >
 -------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 _______________________________________________
< TASK [iptables : Install iptables-persistent] >
 -----------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-2]
ok: [manmanmano-1]
 __________________________________________
< TASK [iptables : Fix ssl bug for docker] >
 ------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-1]
ok: [manmanmano-2]
 ________________________________
< TASK [iptables : Load on boot] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-3]
ok: [manmanmano-2]
ok: [manmanmano-1]
 ____________________________________
< TASK [iptables : Restore iptables] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


[WARNING]: Attempts to restore iptables state without rollback in case of
mistake may lead the ansible controller to loose access to the hosts and never
regain it before fixing firewall rules through a serial console, or any other
way except SSH. Please set task attribute 'poll' (=15) to 0, and 'async' (=0)
to a value >2 and not greater than 'ansible_timeout' (=10) (recommended).
[WARNING]: Attempts to restore iptables state without rollback in case of
mistake may lead the ansible controller to loose access to the hosts and never
regain it before fixing firewall rules through a serial console, or any other
way except SSH. Please set task attribute 'poll' (=15) to 0, and 'async' (=0)
to a value >2 and not greater than 'ansible_timeout' (=10) (recommended).
[WARNING]: Attempts to restore iptables state without rollback in case of
mistake may lead the ansible controller to loose access to the hosts and never
regain it before fixing firewall rules through a serial console, or any other
way except SSH. Please set task attribute 'poll' (=15) to 0, and 'async' (=0)
to a value >2 and not greater than 'ansible_timeout' (=10) (recommended).
ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 _______________
< PLAY [Docker] >
 ---------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ________________________________
< TASK [docker : Docker package] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-3]
ok: [manmanmano-2]
 ________________________________
< TASK [docker : Docker service] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 ______________
< PLAY [Agama] >
 --------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ___________________________
< TASK [agama : /opt/agama] >
 ---------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 ____________________________________
< TASK [agama : Download dockerfile] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-3]
ok: [manmanmano-1]
 ____________________________
< TASK [agama : Agama image] >
 ----------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 _________________________________
< TASK [agama : Agama containers] >
 ---------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1] => (item={'key': 'agama-1', 'value': 8001})
ok: [manmanmano-3] => (item={'key': 'agama-1', 'value': 8001})
ok: [manmanmano-2] => (item={'key': 'agama-1', 'value': 8001})
ok: [manmanmano-1] => (item={'key': 'agama-2', 'value': 8010})
ok: [manmanmano-2] => (item={'key': 'agama-2', 'value': 8010})
ok: [manmanmano-3] => (item={'key': 'agama-2', 'value': 8010})
 ___________________
< PLAY [Prometheus] >
 -------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ________________________________________
< TASK [prometheus : Install Prometheus] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ________________________________________
< TASK [prometheus : Service prometheus] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 _____________________________________
< TASK [prometheus : prometheus.yaml] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 _____________________________________________
< TASK [prometheus : /etc/default/prometheus] >
 ---------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ________________
< PLAY [Grafana] >
 ----------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ____________________________________
< TASK [grafana : Grafana directory] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ________________________________________
< TASK [grafana : Grafana configuration] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ___________________________________________________
< TASK [grafana : Grafana dashboard and datasource] >
 ---------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2] => (item=dashboards)
ok: [manmanmano-2] => (item=datasources)
 _____________________________________
< TASK [grafana : Grafana dashboards] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2] => (item={'src': 'dashboard.yaml', 'dest': 'dashboards'})
ok: [manmanmano-2] => (item={'src': 'datasource.yaml', 'dest': 'datasources'})
 _____________________________________
< TASK [grafana : Grafana dashboards] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2] => (item={'src': 'main.json', 'dest': 'main.json'})
ok: [manmanmano-2] => (item={'src': 'mysql.json', 'dest': 'mysql.json'})
ok: [manmanmano-2] => (item={'src': 'syslog.json', 'dest': 'syslog.json'})
 ___________________________________________
< TASK [grafana : Grafana docker container] >
 -------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 _________________
< PLAY [InfluxDB] >
 -----------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 ____________________________
< TASK [influxdb : Repo key] >
 ----------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 _____________________________________
< TASK [influxdb : Add influxdb repo] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ____________________________________
< TASK [influxdb : Install influxdb] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ______________________________________
< TASK [influxdb : Copy influxdb.conf] >
 --------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ____________________________________
< TASK [influxdb : Service influxdb] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ____________________________________
< TASK [influxdb : Install telegraf] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ______________________________________
< TASK [influxdb : Copy telegraf.conf] >
 --------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ____________________________________
< TASK [influxdb : Service telegraf] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 __________________________________________________________
< TASK [influxdb_exporter : Copy influxdb-exporter binary] >
 ----------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ________________________________
/ TASK [influxdb_exporter : Copy \
\ prometheus-influxdb-exporter]  /
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ___________________________________
/ TASK [influxdb_exporter : Service \
\ prometheus-influxdb-exporter]     /
 -----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 _____________________________________________________________
< TASK [influxdb_backup : Create a directory for user backup] >
 -------------------------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ___________________________________________
< TASK [influxdb_backup : InfluxDB crontab] >
 -------------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 _______________
< PLAY [Pinger] >
 ---------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 _______________________________
< TASK [pinger : Install fping] >
 -------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ____________________________________
< TASK [pinger : Create user pinger] >
 ------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 __________________________________
< TASK [pinger : Copy pinger.conf] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ________________________________
< TASK [pinger : Copy pinger.sh] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 _____________________________________
< TASK [pinger : Copy pinger.service] >
 -------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ________________________________
< TASK [pinger : Pinger service] >
 --------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
 ________________
< PLAY [Rsyslog] >
 ----------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


 __________________________________
< TASK [rsyslog : Service rsyslog] >
 ----------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-2]
ok: [manmanmano-1]
ok: [manmanmano-3]
 ________________________________________
< TASK [rsyslog : Copy 10-telegraf.conf] >
 ----------------------------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


ok: [manmanmano-1]
ok: [manmanmano-2]
ok: [manmanmano-3]
 ____________
< PLAY RECAP >
 ------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/


manmanmano-1               : ok=65   changed=0    unreachable=0    failed=0    skipped=6    rescued=0    ignored=0   
manmanmano-2               : ok=98   changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
manmanmano-3               : ok=65   changed=0    unreachable=0    failed=0    skipped=5    rescued=0    ignored=0   

+ date
Thu Dec  9 12:47:15 PM EET 2021
